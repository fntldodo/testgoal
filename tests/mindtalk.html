<!-- ê³µí†µ ì•ˆì •í™” -->
<script src="../js/error-proof.js" defer></script>

<!-- âœ… ì„ì‹œ ì¸ë¼ì¸: mindtalk ë¡œì§ (ê²½ë¡œ ë¬¸ì œ ìš°íšŒ) -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const Q = [
    {k:'K', q:'ì‹¤ìˆ˜í–ˆì„ ë•Œ â€œê´œì°®ì•„, ëˆ„êµ¬ë‚˜ ê·¸ëŸ´ ìˆ˜ ìˆì–´â€ë¼ê³  ìŠ¤ìŠ¤ë¡œë¥¼ ë‹¬ëœë‹¤.'},
    {k:'K', q:'ì§€ì¹œ ë‚ ì—” ë‚˜ë¥¼ ìœ„í•´ ì‘ì€ ì„ ë¬¼ì´ë‚˜ ì‰¬ëŠ” ì‹œê°„ì„ ë§ˆë ¨í•œë‹¤.'},
    {k:'G', q:'ë¬¸ì œê°€ ìƒê¸°ë©´ ë°°ìš¸ ì ì´ë‚˜ ë‹¤ìŒ ì„ íƒì§€ë¥¼ ë¨¼ì € ë– ì˜¬ë¦°ë‹¤.'},
    {k:'G', q:'ì™„ë²½ë³´ë‹¤ â€œì§„í–‰ ì¤‘(Progress)â€ì„ ë” ì¤‘ìš”í•˜ê²Œ ë³¸ë‹¤.'},
    {k:'N', q:'ì‚¬ì†Œí•œ ì‹¤ìˆ˜ë„ ì˜¤ë˜ ê³±ì”¹ìœ¼ë©° ìŠ¤ìŠ¤ë¡œë¥¼ íƒ“í•œë‹¤.'},
    {k:'N', q:'ì¹­ì°¬ë³´ë‹¤ ë¶€ì¡±í•œ ì ì— ë¨¼ì € ì‹œì„ ì´ ê°„ë‹¤.'},
    {k:'A', q:'ë¶ˆí¸í•œ ê°ì •ì´ ì˜¬ë¼ì˜¤ë©´ ëŒ€í™”ë¥¼ ë¯¸ë£¨ê±°ë‚˜ í”¼í•œë‹¤.'},
    {k:'A', q:'ê°ˆë“± ìƒí™©ì„ ë– ì˜¬ë¦¬ë©´ â€œê·¸ëƒ¥ ë„˜ì–´ê°€ìâ€ê°€ ìì£¼ ë– ì˜¤ë¥¸ë‹¤.'},
    {k:'K', q:'ìš”ì¦˜ì˜ ë‚˜ì—ê²Œ â€œì¶©ë¶„íˆ ì˜í•˜ê³  ìˆì–´â€ë¼ëŠ” ë§ì„ í•´ì£¼ê³  ì‹¶ë‹¤.'},
    {k:'G', q:'ì‘ì€ ì‹œë„ë¼ë„ í•´ë³´ë©´ ë§ˆìŒì´ í•œê²° ê°€ë²¼ì›Œì§„ë‹¤.'},
    {k:'N', q:'â€œì™œ ì´ê²ƒë°–ì— ëª» í–ˆì§€?â€ì™€ ê°™ì€ ë§ì´ ë¨¸ë¦¿ì†ì—ì„œ ë§´ëˆë‹¤.'},
    {k:'A', q:'í˜ë“  ê°ì •ì„ ë§ë¡œ í‘œí˜„í•˜ëŠ” ì¼ì´ ì–´ë µë‹¤.'}
  ];

  // í•„ìˆ˜ DOM
  const stepLabel = document.getElementById('stepLabel');
  const barFill   = document.getElementById('barFill');
  const qText     = document.getElementById('qText');
  const wrap      = document.getElementById('choiceWrap');
  const card      = document.getElementById('card');
  const resultBox = document.getElementById('result');
  const prevBtn   = document.getElementById('prev');
  const skipBtn   = document.getElementById('skip');

  if(!stepLabel||!barFill||!qText||!wrap||!card||!resultBox){
    console.error('[mindtalk] í•„ìˆ˜ DOM ì—†ìŒ');
    qText.textContent = 'ë¡œë”© ì˜¤ë¥˜: í•„ìˆ˜ ìš”ì†Œ ëˆ„ë½';
    return;
  }

  let idx=0;
  const score={K:0,G:0,N:0,A:0};
  const ans=[]; const times=[]; let startTime=Date.now();

  function render(){
    stepLabel.textContent = `${idx+1} / ${Q.length}`;
    barFill.style.width   = `${(idx/Q.length)*100}%`;
    qText.textContent     = Q[idx].q;
    wrap.innerHTML = `
      <button class="choice" data-s="4" type="button">ë§¤ìš° ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="3" type="button">ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="2" type="button">ë³´í†µì´ë‹¤</button>
      <button class="choice ghost" data-s="1" type="button">ì•„ë‹ˆë‹¤</button>
      <button class="choice ghost" data-s="0" type="button">ì „í˜€ ì•„ë‹ˆë‹¤</button>`;
    const prevSel = ans[idx];
    if(prevSel!==undefined){
      [...wrap.children].forEach(b=>{ if(+b.dataset.s===prevSel) b.classList.add('selected');});
    }
    [...wrap.children].forEach(btn=>{
      btn.addEventListener('click',()=>{
        [...wrap.children].forEach(c=>c.classList.remove('selected'));
        btn.classList.add('selected');
        setTimeout(()=>choose(+btn.dataset.s),160);
      });
    });
    startTime=Date.now();
  }

  const weight = s=>{
    if(s<1) return 0.9; if(s<4) return 1.0; if(s<8) return 1.15; return 1.1;
  };

  function choose(v){
    const elapsed=(Date.now()-startTime)/1000;
    times[idx]=elapsed;
    const k=Q[idx].k;
    const w=weight(elapsed);
    const adjusted = v + (v*(w-1)*0.2);
    score[k]+=adjusted; ans[idx]=v;
    next();
  }
  function next(){
    idx++; if(idx<Q.length) render(); else finish();
  }
  prevBtn.addEventListener('click',()=>{
    if(idx===0) return; idx--;
    score.K=score.G=score.N=score.A=0;
    for(let i=0;i<idx;i++){
      const v=ans[i]??0, k=Q[i].k, el=times[i]??4;
      const w=weight(el); score[k]+= v + (v*(w-1)*0.2);
    }
    render();
  });
  skipBtn.addEventListener('click',()=>{ ans[idx]=0; times[idx]=(Date.now()-startTime)/1000; next(); });

  const TYPE={
    K_ONLY:{title:'ğŸµ ë”°ëœ»í•œ ì‘ì›ê°€',quote:'â€œê´œì°®ì•„, ì˜¤ëŠ˜ì˜ ë‚˜ë¡œ ì¶©ë¶„í•´.â€',desc:'ìê¸°ì—°ë¯¼ê³¼ ë‹¤ì •í•¨ì´ ê¸°ë³¸ê°’. ì‹¤íŒ¨ë¥¼ ë°°ì›€ìœ¼ë¡œ ë°”ê¾¸ëŠ” í˜.',remind:'í•˜ë£¨ í•œ ë²ˆ â€œì‘ì€ íœ´ì‹ ì•ŒëŒâ€ì„ ë„£ì–´ ì£¼ì„¸ìš”.'},
    G_ONLY:{title:'ğŸŒ± ì„±ì¥ ê²©ë ¤ê°€',quote:'â€œì–´ì œë³´ë‹¤ í•œ ê±¸ìŒì´ë©´ ë¼.â€',desc:'í˜„ì‹¤ì  ë‚™ê´€ì£¼ì˜ì. ë¬¸ì œë¥¼ ë¶„í•´í•´ ë‹¤ìŒ í–‰ë™ìœ¼ë¡œ ì—°ê²°.',remind:'ë©ˆì¶¤ë„ ì„±ì¥ì´ì—ìš”. ì‰¬ëŠ” ì‹œê°„ë„ ê³„íšì—!'},
    N_ONLY:{title:'ğŸª ë‚´ë©´ ë¹„í‰ê°€',quote:'â€œì˜í•´ì•¼ í•˜ëŠ”ë°â€¦ ì•„ì§ ë¶€ì¡±í•´.â€',desc:'ê¸°ì¤€ì´ ë†’ê³  ì±…ì„ê°ì´ í° íƒ€ì…. ì´ë¯¸ ì¶©ë¶„íˆ í•´ë‚¸ ì ë„ ë§ì•„ìš”.',remind:'â€œì™œ ëª»í–ˆì§€?â€ â†’ â€œì˜¤ëŠ˜ í•´ë‚¸ í•œ ê°€ì§€ëŠ”?â€ìœ¼ë¡œ ë°”ê¾¸ê¸°'},
    A_ONLY:{title:'ğŸ«§ íšŒí”¼ ë°©ì–´ê°€',quote:'â€œì¼ë‹¨ ë„˜ê¸°ìâ€¦ ë‚˜ì¤‘ì—.â€',desc:'ì•ˆì „ì„ ìš°ì„ í•˜ë©° ê°ì •ì„ ì²œì²œíˆ ë‹¤ë£¸.',remind:'ì´ë¦„ ë¶™ì´ê¸° â†’ í•œ ì¤„ ê¸°ë¡ â†’ 10ë¶„ ì‚°ì±… ìˆœì„œë¡œ ì•„ì£¼ ì‘ê²Œ'},
    KG:{title:'ğŸŒ¤ í˜„ì‹¤ ì‘ì›ê°€',quote:'â€œë‹¤ì •í•˜ê²Œ, ê·¸ë¦¬ê³  ê¾¸ì¤€í•˜ê²Œ.â€',desc:'ìê¸°ë‹¤ì • + ì‹¤í–‰ë ¥ì˜ ì¢‹ì€ ì¡°í•©.',remind:'ê³¼í•œ ê³„íšì€ ì¤„ì´ê³  íœ´ì‹ë„ â€œê³„íšâ€ì— ë„£ê¸°'},
    KN:{title:'ğŸ§­ ì—„ê²© ì‘ì›ê°€',quote:'â€œë‹¤ì •í•˜ì§€ë§Œ ê¸°ì¤€ì€ ë¶„ëª…íˆ.â€',desc:'ë‹¤ì •í•¨ ì† ì—„ê²©í•¨. ê¸°ì¤€ì„ â€œêµ¬ì²´í™”â€í•˜ë©´ í¸í•´ì ¸ìš”.',remind:'í•˜ë£¨ ëª©í‘œ ìµœëŒ€ 3ê°œ, ì™„ë£Œ ê¸°ì¤€ì„ ë¬¸ì¥ìœ¼ë¡œ'},
    GA:{title:'ğŸŒˆ ìœ ì—° ì„±ì¥ê°€',quote:'â€œì²œì²œíˆ, í•˜ì§€ë§Œ ë©ˆì¶”ì§€ ì•Šê¸°.â€',desc:'íšŒí”¼ë¥¼ ì¸ì§€í•˜ë©´ì„œ ì‘ê²Œ ì „ì§„.',remind:'5ë¶„ë§Œ í•´ë³´ê¸° ê·œì¹™'},
    NA:{title:'â›… ê· í˜• íƒìƒ‰ê°€',quote:'â€œì—„ê²©í•¨ê³¼ ì•ˆì „ ì‚¬ì´ì—ì„œ ê¸¸ ì°¾ëŠ” ì¤‘.â€',desc:'ë¶€ë‹´ì´ í´ìˆ˜ë¡ ì‘ê²ŒÂ·êµ¬ì²´ì ìœ¼ë¡œ.',remind:'â€œì˜¤ëŠ˜ì˜ ìµœì†Œ ìŠ¹ë¦¬ 1ê°€ì§€â€ ì°¾ê¸°'}
  };
  function classify(sc){
    const arr=Object.entries(sc).sort((a,b)=>b[1]-a[1]);
    const [k1,v1]=arr[0],[k2,v2]=arr[1]; const diff=v1-v2;
    const STRICT=3.2; if(diff>=STRICT) return `${k1}_ONLY`;
    const pair=(k1+k2).split('').sort().join('');
    if(pair==='GK') return 'KG'; if(pair==='KN') return 'KN';
    if(pair==='AG') return 'GA'; if(pair==='AN') return 'NA';
    return `${k1}_ONLY`;
  }
  function labelFor(p){ return p>=0.75?'ë†’ìŒ':(p>=0.5?'ì¤‘ê°„':'ë‚®ìŒ');}
  function meters(sc){
    const max=12; const order=[['K','ë”°ëœ»í•¨'],['G','ì„±ì¥'],['N','ë¹„í‰'],['A','íšŒí”¼']];
    return order.map(([k,name])=>{
      const pct=Math.max(0,Math.min(1,sc[k]/max)); const w=Math.round(pct*100);
      const tag=labelFor(pct);
      return `<div style="margin:6px 0">
        <div style="display:flex;justify-content:space-between;font-weight:700">
          <span>${name}</span><span class="pill" aria-label="${w}%">${tag}</span>
        </div>
        <div style="height:8px;background:var(--mint-200);border-radius:999px;overflow:hidden">
          <span style="display:block;height:100%;width:${w}%;background:var(--mint-500)"></span>
        </div></div>`;
    }).join('');
  }
  function finish(){
    card.style.display='none'; barFill.style.width='100%';
    const key=classify(score); const info=TYPE[key]||TYPE.K_ONLY;
    document.getElementById('result').innerHTML = `
      <div class="result-card">
        <div class="result-hero">
          <img src="../assets/mindtalk.png" alt="${info.title}"
               onerror="this.onerror=null; this.src='../assets/mongsil.png'">
          <div><div class="result-title">${info.title}</div>
               <div class="result-desc">${info.quote}</div></div>
        </div>
        <p style="margin:10px 0">${info.desc}</p>
        <div style="margin-top:8px">${meters(score)}</div>
        <div class="result-section" style="margin-top:10px">
          <div class="pill">ì˜¤ëŠ˜ì˜ ë§ˆìŒ ë¦¬ë§ˆì¸ë“œ</div>
          <p style="margin:8px 0">${info.remind}</p>
        </div>
        <div class="result-actions">
          <a class="start" href="../index.html">ë©”ì¸ìœ¼ë¡œ</a>
          <button class="start" onclick="location.reload()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>
        </div>
      </div>`;
    document.getElementById('result').style.display='block';
  }
  render();
});
</script>