/* ===================================================
 * ëª½ì‹¤ëª½ì‹¤ â€” ì—°ì•  ì„±í–¥ ë°¸ëŸ°ìŠ¤ (v2025.2 ë§ˆìŒ ë¦¬ë§ˆì¸ë“œ)
 * ---------------------------------------------------
 * â€¢ 15ë¬¸í•­, 5ì§€ì„ ë‹¤(0~4)
 * â€¢ ì‘ë‹µì‹œê°„ ë³´ì¡° ê°€ì¤‘ì¹˜(Â±20%) â€” ì„ íƒ ìš°ì„ , ë’¤ì—ì§€ ì•ŠìŒ
 * â€¢ ì¶•(4): E(í‘œí˜„), C(êµë¥˜/ê³µê°), S(ì•ˆì •/ì‹ ë¢°), I(ììœ¨/ê±°ë¦¬)
 * â€¢ ê²°ê³¼: ë‹¨ì¼í˜• 4 + í•˜ì´ë¸Œë¦¬ë“œ 6 (ì´ ~10 ê°€ëŠ¥)
 * â€¢ UI: ì ìˆ˜ X, í¼ì„¼íŠ¸ + ìƒíƒœë¼ë²¨(í…ìŠ¤íŠ¸)ë§Œ í‘œì‹œ
 * â€¢ ë°¸ëŸ°ìŠ¤ ê³¼ë‹¤ ë°©ì§€: diff/variance/threshold ë³´ì •
 * =================================================== */

document.addEventListener('DOMContentLoaded', () => {
  // ---------- ë¬¸í•­(ì¶•ë³„ ê· í˜• 15ê°œ) ----------
  const Q = [
    {k:'E', q:'ì¢‹ì•„í•˜ëŠ” ë§ˆìŒì„ í‘œí˜„í•˜ëŠ” í¸ì´ë‹¤.'},
    {k:'S', q:'ì—°ì• ì—ì„œ ì¼ê´€ì„±ê³¼ ì‹ ë¢°ê°€ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤.'},
    {k:'C', q:'ëŒ€í™” ë¹ˆë„ê°€ ë‚®ì•„ì§€ë©´ ë¶ˆì•ˆí•´ì§„ë‹¤.'},
    {k:'I', q:'ì„œë¡œì˜ ê°œì¸ ì‹œê°„ì„ ì¡´ì¤‘í•˜ëŠ” í¸ì´ë‹¤.'},
    {k:'E', q:'ê°ì •ì€ ì ë‹¹íˆ ë“œëŸ¬ë‚´ì•¼ ê´€ê³„ê°€ ìœ ì§€ëœë‹¤ê³  ë¯¿ëŠ”ë‹¤.'},
    {k:'S', q:'ì• ì •ì€ ë§ë³´ë‹¤ ê¾¸ì¤€í•œ í–‰ë™ìœ¼ë¡œ ë³´ì—¬ì•¼ í•œë‹¤.'},
    {k:'C', q:'ìƒëŒ€ ê°ì • ë³€í™”ë¥¼ ê¸ˆë°© ëˆˆì¹˜ì±ˆë‹¤.'},
    {k:'I', q:'ì—°ì• ê°€ ìƒí™œ ì „ì²´ë¥¼ ì ì‹í•˜ì§„ ì•Šê¸¸ ë°”ë€ë‹¤.'},
    {k:'E', q:'ì—°ì•  ì´ˆë°˜ì—ë„ ìŠ¤í‚¨ì‹­ì´ë‚˜ í˜¸ê° í‘œí˜„ì´ ë¹ ë¥¸ í¸ì´ë‹¤.'},
    {k:'S', q:'ì‹¤ìˆ˜ë³´ë‹¤ íƒœë„ì˜ ì¼ê´€ì„±ì´ ë” ì¤‘ìš”í•˜ë‹¤.'},
    {k:'C', q:'ë‹µì¥ì´ ëŠ¦ìœ¼ë©´ ë§ˆìŒì´ ì“°ì¸ë‹¤.'},
    {k:'I', q:'ì—°ì• ì™€ ë³„ê°œë¡œ ë‚˜ë§Œì˜ ë£¨í‹´/ëª©í‘œë¥¼ ì§€í‚¨ë‹¤.'},
    {k:'E', q:'ì‚¬ë‘í•œë‹¤ëŠ” ë§ì„ ìì£¼ ë‚˜ëˆ„ê³  ì‹¶ë‹¤.'},
    {k:'C', q:'ë§ë³´ë‹¤ í‘œì •ê³¼ ë¶„ìœ„ê¸°ë¡œ ë§ˆìŒì„ ì½ëŠ”ë‹¤.'},
    {k:'I', q:'í•¨ê»˜í•´ë„ ê°ìì˜ ì†ë„ë¥¼ ì§€í‚¤ê³  ì‹¶ë‹¤.'},
  ];

  // ---------- ìƒíƒœ ----------
  let idx = 0;
  const score = {E:0, C:0, S:0, I:0};   // ê°€ì¤‘ í•©ê³„(ë‚´ë¶€ìš©)
  const counts= {E:0, C:0, S:0, I:0};   // ì¶•ë³„ ì‘ë‹µ ìˆ˜
  const ans   = [];                     // ì„ íƒ(0~4)
  const times = [];                     // ì´ˆ
  let startedAt = Date.now();

  // ---------- DOM ----------
  const stepLabel = document.getElementById('stepLabel');
  const barFill   = document.getElementById('barFill');
  const qText     = document.getElementById('qText');
  const wrap      = document.getElementById('choiceWrap');
  const card      = document.getElementById('card');
  const result    = document.getElementById('result');
  const prevBtn   = document.getElementById('prev');
  const skipBtn   = document.getElementById('skip');

  // ---------- ë Œë” ----------
  function render(){
    stepLabel.textContent = `${idx+1} / ${Q.length}`;
    barFill.style.width   = `${(idx/Q.length)*100}%`;
    qText.textContent     = Q[idx].q;

    wrap.innerHTML = `
      <button class="choice" data-s="4" type="button">ë§¤ìš° ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="3" type="button">ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="2" type="button">ë³´í†µì´ë‹¤</button>
      <button class="choice ghost" data-s="1" type="button">ì•„ë‹ˆë‹¤</button>
      <button class="choice ghost" data-s="0" type="button">ì „í˜€ ì•„ë‹ˆë‹¤</button>
    `;

    const prevSel = ans[idx];
    if(prevSel !== undefined){
      Array.from(wrap.children).forEach(b=>{
        if(Number(b.dataset.s)===prevSel) b.classList.add('selected');
      });
    }

    Array.from(wrap.children).forEach(btn=>{
      btn.addEventListener('click', ()=>{
        Array.from(wrap.children).forEach(c=>c.classList.remove('selected'));
        btn.classList.add('selected');
        setTimeout(()=>choose(Number(btn.dataset.s)), 140);
      });
    });

    startedAt = Date.now();
  }

  // ---------- ì‹œê°„ ê°€ì¤‘ì¹˜(ë³´ì¡°) ----------
  function weight(sec){
    // 0.85 ~ 1.15
    if (sec < 1)  return 0.90;   // ë„ˆë¬´ ë¹ ë¦„: ì•½ê°„ ê°ì 
    if (sec < 4)  return 1.00;   // ì •ìƒ
    if (sec < 8)  return 1.12;   // ìˆ™ê³ : ì†Œí­ ê°€ì‚°
    return 1.08;                 // ê³¼ë„ ìˆ™ê³ : ì™„ë§Œ ê°€ì‚°
  }

  // ---------- ì„ íƒ ì²˜ë¦¬ ----------
  function choose(s){
    const elapsed = (Date.now() - startedAt)/1000;
    times[idx] = elapsed;

    const k = Q[idx].k;
    const w = weight(elapsed);
    ans[idx] = s;

    // ì„ íƒì´ ìµœìš°ì„ , ì‹œê°„ì€ Â±20% ìº¡ ì•ˆì—ì„œ ë³´ì¡°
    const adjusted = s + (s * (w - 1) * 0.2);
    score[k]  += adjusted;
    counts[k] += 1;

    next();
  }

  function next(){
    idx++;
    if(idx < Q.length) render();
    else finish();
  }

  prevBtn?.addEventListener('click', ()=>{
    if(idx===0) return;
    idx--;
    recalcTo(idx);
    render();
  });

  skipBtn?.addEventListener('click', ()=>{
    ans[idx]   = 0;
    times[idx] = (Date.now()-startedAt)/1000;
    next();
  });

  function recalcTo(end){
    score.E=score.C=score.S=score.I=0;
    counts.E=counts.C=counts.S=counts.I=0;
    for(let i=0;i<end;i++){
      const s = ans[i] ?? 0;
      const k = Q[i].k;
      const w = weight(times[i] ?? 0);
      const adjusted = s + (s * (w - 1) * 0.2);
      score[k]  += adjusted;
      counts[k] += 1;
    }
  }

  // ---------- í¼ì„¼íŠ¸ & ìƒíƒœë¼ë²¨ ----------
  function toPct(k){
    const max = (counts[k] || 0) * 4; // 4ê°€ ìµœëŒ€ ì„ íƒ
    if(!max) return 0;
    const p = Math.round((score[k] / max) * 100);
    return Math.max(0, Math.min(100, p));
  }
  function labelOf(p){
    if(p >= 80) return 'ì•„ì£¼ ë†’ìŒ';
    if(p >= 65) return 'ë†’ìŒ';
    if(p >= 50) return 'ì¤‘ê°„';
    if(p >= 35) return 'ë‚®ìŒ';
    return 'ì•„ì£¼ ë‚®ìŒ';
  }

  // ---------- ìœ í˜• íŒì •(ë°¸ëŸ°ìŠ¤ ê³¼ë‹¤ ë°©ì§€ í¬í•¨) ----------
  const TYPE_COPY = {
    E_ONLY: {
      title:'ğŸ’— í‘œí˜„ ìŠ¤íŒŒí¬í˜•',
      quote:'â€œë§ˆìŒì€ ì „í•  ë•Œ ì‚´ì•„ë‚œë‹¤.â€',
      text:`ê°ì •ì˜ ì˜¨ë„ë¥¼ ì˜¬ë¦¬ëŠ” ë¦¬ë“œ í”Œë ˆì´ì–´ì˜ˆìš”. ì¢‹ì•„í•˜ë©´ í‹°ê°€ ë‚˜ê³ , ì• ì •í‘œí˜„ì„ í†µí•´ ê´€ê³„ì˜ ë¦¬ë“¬ì„ ë§Œë“­ë‹ˆë‹¤. 
ë‹¤ë§Œ ë§ˆìŒì˜ ì†ë„ê°€ ë„ˆë¬´ ì•ì„œê°€ë©´ ì§€ì¹˜ê¸° ì‰¬ì›Œìš”. ìƒëŒ€ì˜ í˜ì´ìŠ¤ë¥¼ â€˜í•œ ë°•ì ë“£ê³ â€™ ë§ì¶”ë©´ ë” ë‹¨ë‹¨í•´ì ¸ìš”.`,
      remind:'ë§ê³¼ í–‰ë™ì´ í•¨ê»˜ ê°ˆ ë•Œ ì‚¬ë‘ì˜ ì˜¨ë„ëŠ” ì˜¤ë˜ ìœ ì§€ë¼ìš”. ì˜¤ëŠ˜ì€ â€œì˜ ë“¤ì—ˆì–´â€ í•œ ë¬¸ì¥ì„ í•¨ê»˜ ì„ ë¬¼í•´ ë³´ì„¸ìš”.'
    },
    C_ONLY: {
      title:'ğŸ¤ ê³µê° ë„¤ë¹„ê²Œì´í„°í˜•',
      quote:'â€œë„ˆì˜ ë¦¬ë“¬ì„ ë¨¼ì € ë“£ëŠ”ë‹¤.â€',
      text:`ìƒëŒ€ì˜ ë§ˆìŒê²°ì„ ì„¸ì‹¬íˆ ì½ëŠ” í˜‘ë ¥ê°€ì˜ˆìš”. ëŒ€í™” ì˜¨ë„ë¥¼ ë§ì¶”ê³  ë¶„ìœ„ê¸°ë¥¼ ë¶€ë“œëŸ½ê²Œ ë§Œë“œëŠ” ì¬ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.
ê°€ë”ì€ ìŠ¤ìŠ¤ë¡œì˜ ê°ì •ë„ ìš°ì„ ìˆœìœ„ì— ì˜¬ë ¤ë‘ì„¸ìš”. ë‚˜ì˜ ì†ë„ë¥¼ ì¡´ì¤‘í•  ë•Œ ì—°ê²°ì€ ë” ê±´ê°•í•´ì§‘ë‹ˆë‹¤.`,
      remind:'ì˜¤ëŠ˜ì˜ í•œ ì¤„: â€œë‚´ ë§ˆìŒë„ í•¨ê»˜ ì‚´í”¼ê¸°.â€ ê·€ ê¸°ìš¸ì„ì˜ ì ˆë°˜ì€ ë‚˜ë¥¼ í–¥í•´ë„ ê´œì°®ì•„ìš”.'
    },
    S_ONLY: {
      title:'ğŸ§­ ì‹ ë¢° ì•µì»¤í˜•',
      quote:'â€œê¾¸ì¤€í•¨ì´ ì‚¬ë‘ì„ ì§€í‚¨ë‹¤.â€',
      text:`ì•½ì†ê³¼ ì¼ê´€ì„±ìœ¼ë¡œ ì•ˆì •ê°ì„ ì£¼ëŠ” íƒ€ì…ì´ì—ìš”. ë³€ë•ë³´ë‹¤ ì§€ì†ì„ ì¤‘ì‹œí•˜ê³ , ê´€ê³„ë¥¼ ì˜¤ë˜ ì§€í‚¤ëŠ” í˜ì´ í½ë‹ˆë‹¤.
ê°€ë”ì€ ì‘ì€ ì¦‰í¥ì„±ì„ í—ˆë½í•´ë„ ì¢‹ì•„ìš”. ì˜ˆìƒ ë°–ì˜ ë‹¤ì •í•¨ì´ ë‘˜ ì‚¬ì´ì˜ ì˜¨ë„ë¥¼ ë†’ì—¬ì¤ë‹ˆë‹¤.`,
      remind:'ë£¨í‹´ + ì‘ì€ ë³€ì£¼ = ê´€ê³„ì˜ íƒ„ë ¥. ì˜¤ëŠ˜ì€ ìµìˆ™í•¨ ì†ì— 1%ì˜ ìƒˆë¡œì›€ì„ ë”í•´ë³´ì„¸ìš”.'
    },
    I_ONLY: {
      title:'ğŸ•Šï¸ ììœ  ë°”ëŒí˜•',
      quote:'â€œìˆ¨ ì‰´ ê³µê°„ì´ ì‚¬ë‘ì„ ì˜¤ë˜ê°€ê²Œ í•œë‹¤.â€',
      text:`ììœ¨ì„±ê³¼ ë…ë¦½ì„±ì„ ì¤‘ì‹œí•˜ëŠ” íƒ€ì…ì´ì—ìš”. í•¨ê»˜ì—¬ë„ ê°ìì˜ ì†ë„ë¥¼ ì§€í‚¬ ë•Œ ë§Œì¡±ë„ê°€ ë†’ìŠµë‹ˆë‹¤.
ì¡°ê¸ˆë§Œ ë” â€œí•¨ê»˜ì˜ ìˆœê°„â€ì— ì§‘ì¤‘í•˜ë©´, ììœ ì™€ ì—°ê²°ì´ ì¶©ëŒí•˜ì§€ ì•Šê³  ì¡°í™”ë¡­ê²Œ íë¥¼ ê±°ì˜ˆìš”.`,
      remind:'ë‚˜ì˜ ê³µê°„ì„ ì§€í‚¤ë“¯, í•¨ê»˜ì˜ ìˆœê°„ì— ê¹ƒë°œì„ ê½‚ì•„ë³´ì„¸ìš”. ì§§ì•„ë„ ì§„ì‹¬ì´ë©´ ì¶©ë¶„í•´ìš”.'
    },
    EC: {
      title:'ğŸ’ ë”°ëœ»í•œ ì»¤ë®¤ë‹ˆì¼€ì´í„°í˜• (í‘œí˜„+ê³µê°)',
      quote:'â€œë§ˆìŒì€ ë‚˜ëˆ„ê³ , ê·€ëŠ” ì—´ê³ .â€',
      text:`ë¹ ë¥¸ ì• ì •í‘œí˜„ê³¼ ì„¬ì„¸í•œ ê²½ì²­ì´ ì˜ ì–´ìš¸ë¦¬ëŠ” ì¡°í•©ì´ì—ìš”. ê´€ê³„ì˜ ì˜¨ë„ë¥¼ ë¶€ë“œëŸ½ê²Œ ë†’ì´ëŠ” ë° ê°•ì ì´ ìˆì–´ìš”.
ë‹¨, ê°ì •ì˜ íŒŒë„ì— ê³¼í•˜ê²Œ ëª°ì…í•˜ë©´ ì²´ë ¥ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ íœ´ì‹ ì‹ í˜¸ë¥¼ ë¯¸ë¦¬ ì •í•´ë‘ë©´ ì¢‹ì•„ìš”.`,
      remind:'ê°ì •ì€ íë¥´ê³ , ìš°ë¦¬ëŠ” ë¨¸ë¬´ë¦…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ â€œì ê¹ ì‰¬ìâ€ ì‹ í˜¸ë¥¼ í•¨ê»˜ ì•½ì†í•´ìš”.'
    },
    ES: {
      title:'ğŸŒ· ì¼ê´€ëœ ë‹¤ì •í˜• (í‘œí˜„+ì•ˆì •)',
      quote:'â€œë”°ëœ»í•¨ì„ ê¾¸ì¤€íˆ.â€',
      text:`ì• ì •í‘œí˜„ê³¼ ì‹ ë¢°ë¥¼ ë™ì‹œì— ì±™ê¸°ëŠ” íƒ€ì…ì´ì—ìš”. ë§ê³¼ í–‰ë™ì˜ ê°„ê²©ì´ ì§§ì•„ ì‹ ë¢°ë¥¼ ë¹ ë¥´ê²Œ ìŒ“ìŠµë‹ˆë‹¤.
ì¢…ì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸ì—ì„œ ë²—ì–´ë‚˜, ê°ì •ì˜ ì—¬ë°±ì„ í—ˆìš©í•˜ë©´ ë” í¸ì•ˆí•´ì ¸ìš”.`,
      remind:'ê³„íší‘œ ì‚¬ì´ì— â€œê°ì • ì—¬ë°± 10ë¶„â€ì„ ë„£ì–´ë³´ì„¸ìš”. ë‹¤ì •í•¨ì€ ì‰¬ì–´ê°ˆ í‹ˆì—ì„œ ë” ì˜¤ë˜ê°€ìš”.'
    },
    EI: {
      title:'ğŸˆ ìœ ì¾Œí•œ ë…ë¦½í˜• (í‘œí˜„+ììœ¨)',
      quote:'â€œê°€ë³ê²Œ, ê·¸ëŸ¬ë‚˜ ì§„ì‹¬ìœ¼ë¡œ.â€',
      text:`í‘œí˜„ì€ ì ê·¹ì ì´ê³  êµ¬ì†ì€ ì‹«ì€ ë°ì€ ì—ë„ˆì§€ì˜ ì†Œìœ ìì˜ˆìš”. ììœ ë¡­ì§€ë§Œ ì±…ì„ê° ìˆê²Œ ê´€ê³„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
ê°€ë”ì€ ì†ë„ë¥¼ í•œ í†¤ ë‚®ì¶”ê³ , í˜„ì¬ì˜ ê°ê°ì— ë¨¸ë¬¼ë©´ ê¹Šì´ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ë”°ë¼ì™€ìš”.`,
      remind:'ì˜¤ëŠ˜ì˜ í•©ì˜: â€œì„œë¡œì˜ ì‹œê°„ ì¡´ì¤‘ + ë§Œë‚˜ëŠ” ì‹œê°„ ì§‘ì¤‘â€. ë°¸ëŸ°ìŠ¤ê°€ í¸ì•ˆí•¨ì„ ë§Œë“¤ì–´ìš”.'
    },
    CS: {
      title:'ğŸ«¶ ì˜¨ì •ì  ìˆ˜í˜¸ìí˜• (ê³µê°+ì•ˆì •)',
      quote:'â€œë§ˆìŒì„ ì§€í‚¤ëŠ” ë°©ë²•ì„ ì•ˆë‹¤.â€',
      text:`ê³µê°ê³¼ ì‹ ë¢°ì˜ í•©ìœ¼ë¡œ ê´€ê³„ë¥¼ ë‹¨ë‹¨íˆ ì§€í‚¤ëŠ” íƒ€ì…ì´ì—ìš”. ìƒëŒ€ê°€ ê¸°ëŒ€ ì‰¬ëŠ” ë“±ë°›ì´ê°€ ë˜ì–´ì¤ë‹ˆë‹¤.
ë‚´ ë§ˆìŒì˜ ë¬´ê²Œë„ ê°€ë³ê²Œ ë‚´ë ¤ë†“ì„ ê³³ì´ í•„ìš”í•´ìš”. â€˜ë‚˜ë¥¼ ìœ„í•œ ì¼€ì–´â€™ë¥¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ì— ì˜¬ë ¤ë‘ì„¸ìš”.`,
      remind:'â€œë‚˜ ëŒë´„ í•œ ê°€ì§€â€ë¥¼ ì˜¤ëŠ˜ì˜ ì™„ë£Œ í•­ëª©ìœ¼ë¡œ. ê´€ê³„ì˜ ì˜¨ê¸°ëŠ” ë‚˜ì—ê²Œë„ ê³µí‰í•´ìš”.'
    },
    CI: {
      title:'ğŸŒ¤ï¸ ë°°ë ¤ì  ë…ë¦½í˜• (ê³µê°+ììœ¨)',
      quote:'â€œê°€ê¹Œì›€ë„, ê±°ë¦¬ë„ ì¡´ì¤‘ì´ì•¼.â€',
      text:`ë°°ë ¤í•˜ì§€ë§Œ ì˜ì¡´ì€ ìµœì†Œí™”í•˜ëŠ” ê· í˜• ì¡íŒ íƒ€ì…ì´ì—ìš”. ì„¬ì„¸í•¨ê³¼ ë…ë¦½ì„±ì„ ìƒí™©ì— ë§ê²Œ ì¡°ì ˆí•©ë‹ˆë‹¤.
ê°„í˜¹ ì˜ì‚¬í‘œí˜„ì´ ëŠ¦ì–´ì§ˆ ìˆ˜ ìˆì–´ìš”. â€˜ë‚˜ì˜ ë¦¬ë“¬â€™ì„ í•œ ì¤„ë¡œ ë¯¸ë¦¬ ê³µìœ í•˜ë©´ ë” í¸í•´ì ¸ìš”.`,
      remind:'ì˜¤ëŠ˜ì˜ í•œ ì¤„ ì†Œê°œ: â€œë‚˜ëŠ” ì´ë ‡ê²Œ ì‚¬ë‘í•˜ê³  ì´ë ‡ê²Œ ì‰¬ì–´ìš”.â€ ë¦¬ë“¬ ê³µìœ ê°€ ê´€ê³„ë¥¼ ê°€ë³ê²Œ í•´ìš”.'
    },
    IS: {
      title:'ğŸŒ¿ ì°¨ë¶„í•œ íŒŒíŠ¸ë„ˆì‹­í˜• (ììœ¨+ì•ˆì •)',
      quote:'â€œëŠë¦¬ì§€ë§Œ ê²¬ê³ í•˜ê²Œ.â€',
      text:`ììœ¨ê³¼ ì•ˆì •ì˜ í•©ìœ¼ë¡œ ê³¼ì¥ ì—†ì´ ì˜¤ë˜ ê°€ëŠ” íƒ€ì…ì´ì—ìš”. ì†ë„ë³´ë‹¤ëŠ” ë°©í–¥ì— ì§‘ì¤‘í•´ìš”.
ë•Œë•Œë¡œ ê°ì •ì˜ ìƒ‰ì„ ë§ì¹ í•˜ë©´, ë‹´ë°±í•¨ ìœ„ì— ë”°ëœ»í•¨ì´ ì–¹í™ë‹ˆë‹¤.`,
      remind:'ì˜¤ëŠ˜ì˜ í•œ ë¬¸ì¥ ê°ì •í‘œí˜„ìœ¼ë¡œ, ë‹´ë°±í•¨ì— ì˜¨ê¸°ë¥¼ 1ë„ ì˜¬ë ¤ë³´ì„¸ìš”.'
    }
  };

  function classify(p){ // p: {E,C,S,I} í¼ì„¼íŠ¸
    // ì •ë ¬
    const arr = Object.entries(p).sort((a,b)=>b[1]-a[1]); // [ [k, pct] ... ]
    const [k1,v1] = arr[0];
    const [k2,v2] = arr[1];
    const [k3,v3] = arr[2];
    const [k4,v4] = arr[3];

    // í¸ì°¨ & ë¶„ì‚° ê¸°ë°˜ ë°¸ëŸ°ìŠ¤ ê³¼ë‹¤ ë°©ì§€
    const diff12 = v1 - v2;
    const mean   = (v1+v2+v3+v4)/4;
    const variance = ([v1,v2,v3,v4].reduce((a,c)=>a+(c-mean)**2,0))/4;

    // ì„ê³„ê°’
    const SINGLE_TH = 12;  // ë‹¨ì¼í˜•
    const HYBRID_TH = 8;   // í•˜ì´ë¸Œë¦¬ë“œ
    const VAR_BOOST = variance >= 150 ? 4 : (variance >= 80 ? 2 : 0); // ë¶„ì‚° ë†’ìœ¼ë©´ ë‹¨ì¼/ë³µí•©ìœ¼ë¡œ ê°€ì¤‘

    if (diff12 + VAR_BOOST >= SINGLE_TH) {
      return `${k1}_ONLY`;
    }
    if (diff12 + VAR_BOOST >= HYBRID_TH) {
      return [k1,k2].sort().join(''); // EC/ES/EI/CS/CI/IS
    }
    // ì •ë§ ëª¨ë‘ ë¹„ìŠ·í•  ë•Œë§Œ ê· í˜•ìœ¼ë¡œ (ì—¬ê¸´ ìµœì†Œ ì‚¬ìš©, ê¸°ë³¸ì€ í•˜ì´ë¸Œë¦¬ë“œë¡œ ë¶„ë¥˜ë¨)
    return [k1,k2].sort().join('');
  }

  // ---------- ê²°ê³¼ ì¹´ë“œ ----------
  function bar(label, pct){
    const state = labelOf(pct);
    return `
    <div style="text-align:left;margin:8px 0">
      <div style="display:flex;justify-content:space-between;font-weight:700">
        <span>${label}</span><span>${pct}% Â· ${state}</span>
      </div>
      <div style="height:8px;background:var(--mint-200);border-radius:999px;overflow:hidden">
        <span style="display:block;height:100%;width:${pct}%;background:var(--mint-500)"></span>
      </div>
    </div>`;
  }

  function finish(){
    card.style.display='none';
    barFill.style.width='100%';

    const pct = {
      E: toPct('E'),
      C: toPct('C'),
      S: toPct('S'),
      I: toPct('I')
    };

    const key = classify(pct);
    const info = TYPE_COPY[key] || {
      title:'â˜ï¸ ëª½ì‹¤í˜•',
      quote:'â€œí•¨ê»˜ ë§ì¶°ê°€ìš”.â€',
      text:'ë°ì´í„°ê°€ ì¡°ê¸ˆ ì ì–´ìš”. í•œ ë²ˆ ë” ê°€ë³ê²Œ ì‹œë„í•´ë³¼ê¹Œìš”?',
      remind:'ì˜¤ëŠ˜ì˜ ì‘ì€ ì œì•ˆ: ì§ˆë¬¸ í•˜ë‚˜ë¡œ ì‹œì‘í•´ìš”. â€œì§€ê¸ˆ, ì–´ë–¤ ìƒ‰ì˜ í•˜ë£¨ì˜€ì–´?â€'
    };

    // ê°ì •ìƒíƒœ ìš”ì•½(ì¶• 2ê°œ í‚¤ì›Œë“œë¡œ ê°„ë‹¨ ë¬˜ì‚¬)
    const mood = (() => {
      const arr = Object.entries(pct).sort((a,b)=>b[1]-a[1]).map(([k])=>k);
      const top2 = arr.slice(0,2).sort().join('');
      const map = {
        CE:'ë”°ëœ»í•œ ëŒ€í™”ê°€ ì˜ íë¥´ëŠ” ë‚ ',
        CS:'ë¯¿ìŒì´ í¸ì•ˆí•¨ì„ ë§Œë“œëŠ” ë‚ ',
        CI:'ë°°ë ¤ì™€ ì—¬ìœ ê°€ ê³µì¡´í•˜ëŠ” ë‚ ',
        EI:'ë°ê³  ììœ ë¡œìš´ ë‚ ',
        ES:'ë‹¤ì •í•¨ì´ ê¾¸ì¤€íˆ ì´ì–´ì§€ëŠ” ë‚ ',
        IS:'ì°¨ë¶„í•œ ì§‘ì¤‘ì´ ì‰¬ìš´ ë‚ ',
        E_ONLY:'í‘œí˜„ ì—ë„ˆì§€ê°€ ì¶©ë§Œí•œ ë‚ ',
        C_ONLY:'ì„¬ì„¸í•œ ê³µê°ì´ ë¹›ë‚˜ëŠ” ë‚ ',
        S_ONLY:'ì•ˆì •ê³¼ ì‹ ë¢°ê°€ ë‹¨ë‹¨í•œ ë‚ ',
        I_ONLY:'ë‚˜ì˜ ì†ë„ê°€ ì„ ëª…í•œ ë‚ '
      };
      return map[key] || 'ê´€ê³„ì˜ ì˜¨ë„ê°€ í¬ê·¼í•œ ë‚ ';
    })();

    // ì¹´ë“œ HTML
    result.innerHTML = `
      <div class="result-card">
        <div class="result-hero">
          <img src="../assets/love.png" alt="ì—°ì•  ìºë¦­í„°" onerror="this.style.display='none'">
          <div>
            <div class="result-title">${info.title}</div>
            <div class="result-desc">â€œ${info.quote}â€</div>
          </div>
        </div>

        <p style="margin:10px 0">${info.text}</p>

        <div class="pill" style="margin:6px 0">${mood}</div>

        <div style="margin-top:8px">
          ${bar('í‘œí˜„', pct.E)}
          ${bar('êµë¥˜', pct.C)}
          ${bar('ì•ˆì •', pct.S)}
          ${bar('ììœ¨', pct.I)}
        </div>

        <div class="result-hint" style="margin-top:10px">
          <div class="pill">ğŸŒ¿ ë§ˆìŒ ë¦¬ë§ˆì¸ë“œ</div>
          <p style="margin:6px 0">${info.remind}</p>
        </div>

        <div class="result-actions">
          <a class="start" href="../index.html">ë©”ì¸ìœ¼ë¡œ</a>
          <button class="start" type="button" onclick="location.reload()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>
        </div>
      </div>
    `;
    result.style.display='block';
  }

  // ì‹œì‘
  render();
});