/* ===================================================
 * ë§ˆìŒ ê¸°ìƒì˜ˆë³´ (5ì§€ì„ ë‹¤ + ì‹œê°„ê°€ì¤‘ì¹˜ Â±20% ë³´ì¡°)
 * ---------------------------------------------------
 * - ë‹µë³€: 0~4 (ì „í˜€/ì•„ë‹ˆë‹¤/ë³´í†µ/ê·¸ë ‡ë‹¤/ë§¤ìš° ê·¸ë ‡ë‹¤)
 * - ì„ íƒ ì ìˆ˜ê°€ í•µì‹¬, ì‘ë‹µ ì‹œê°„ì€ ìµœëŒ€ Â±20% ë³´ì¡°
 * - ì¶•: W(ë”°ëœ»í•¨/ê³µê°), V(ë³€í™”ë„/ê¸°ë³µ), R(íšŒë³µë ¥), I(ë‚´ë©´/ê³ ìš”)
 * - ë¶„ë¥˜(6): SUNNY/ MILD/ VARIABLE/ RAINY/ STORMY/ MOONLIT
 * =================================================== */

document.addEventListener('DOMContentLoaded', () => {
  // 14ë¬¸í•­ (W, V, R, I)
  const Q = [
    {k:'W', q:'í˜ë“  ì´ì•¼ê¸°ë¥¼ ë“¤ìœ¼ë©´ ìì—°ìŠ¤ëŸ½ê²Œ ê³µê°ë¶€í„° í•˜ê²Œ ëœë‹¤.'},
    {k:'W', q:'ì¹œí•œ ì‚¬ëŒì˜ ê°ì • ë³€í™”ë¥¼ ì˜ˆë¯¼í•˜ê²Œ ì•Œì•„ì°¨ë¦¬ëŠ” í¸ì´ë‹¤.'},
    {k:'W', q:'ëŒ€í™”ì—ì„œ ìƒëŒ€ì˜ ê¸°ë¶„ì„ ë¨¼ì € ì‚´í”¼ë ¤ í•œë‹¤.'},

    {k:'V', q:'í•˜ë£¨ ì•ˆì—ì„œë„ ê¸°ë¶„ ê¸°ë³µì´ ê½¤ ìˆëŠ” í¸ì´ë‹¤.'},
    {k:'V', q:'ì‚¬ì†Œí•œ ì¼ì—ë„ ë§ˆìŒì´ ì‰½ê²Œ í”ë“¤ë¦°ë‹¤.'},
    {k:'V', q:'ì–´ì œì˜ ê°ì •ì´ ì˜¤ëŠ˜ ì»¨ë””ì…˜ì— ì˜í–¥ì„ ì¤€ë‹¤.'},

    {k:'R', q:'ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì•„ë„ ê¸ˆë°© ì§„ì • ë°©ë²•ì„ ì°¾ëŠ”ë‹¤.'},
    {k:'R', q:'ì‹¤ìˆ˜ë‚˜ ì‹¤íŒ¨ë¥¼ ì˜¤ë˜ ëŒì§€ ì•Šê³  ê¸ˆì„¸ ë³µêµ¬í•œë‹¤.'},
    {k:'R', q:'ë¶ˆì•ˆì´ ì˜¬ë¼ì™€ë„ í˜¸í¡Â·ì‚°ì±… ë“±ìœ¼ë¡œ ë‹¤ìŠ¤ë¦´ ìˆ˜ ìˆë‹¤.'},

    {k:'I', q:'í˜¼ì ìˆëŠ” ì‹œê°„ì—ì„œ ì•ˆì •ê°ê³¼ ì—ë„ˆì§€ë¥¼ ì–»ëŠ”ë‹¤.'},
    {k:'I', q:'ê°ì •ì„ ê¸°ë¡í•˜ê±°ë‚˜ ì¡°ìš©íˆ ì •ë¦¬í•˜ëŠ” ì‹œê°„ì´ í•„ìš”í•˜ë‹¤.'},
    {k:'I', q:'ì‹œë„ëŸ¬ìš´ ìë¦¬ë³´ë‹¤ëŠ” ê³ ìš”í•œ ê³µê°„ì´ í¸í•˜ë‹¤.'},

    {k:'W', q:'ê°€ê¹Œìš´ ì‚¬ëŒì˜ ì•ˆë¶€ë¥¼ ë¨¼ì € ë¬»ê³  ì±™ê¸°ëŠ” í¸ì´ë‹¤.'},
    {k:'R', q:'ëª¸ ì»¨ë””ì…˜(ìˆ˜ë©´Â·ì‹ì‚¬Â·ìš´ë™)ìœ¼ë¡œ ë§ˆìŒì„ ê´€ë¦¬í•œë‹¤.'},
  ];

  let idx = 0;
  const score  = { W:0, V:0, R:0, I:0 };
  const count  = { W:0, V:0, R:0, I:0 };
  const ans    = [];
  const times  = [];
  let startTime = Date.now();

  // DOM
  const stepLabel = document.getElementById('stepLabel');
  const barFill   = document.getElementById('barFill');
  const qText     = document.getElementById('qText');
  const wrap      = document.getElementById('choiceWrap');
  const card      = document.getElementById('card');
  const resultBox = document.getElementById('result');
  const prevBtn   = document.getElementById('prev');
  const skipBtn   = document.getElementById('skip');

  function render(){
    stepLabel.textContent = `${idx+1} / ${Q.length}`;
    barFill.style.width   = `${(idx/Q.length)*100}%`;
    qText.textContent     = Q[idx].q;

    // 5ì§€ì„ ë‹¤
    wrap.innerHTML = `
      <button class="choice" data-s="4" type="button">ë§¤ìš° ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="3" type="button">ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="2" type="button">ë³´í†µì´ë‹¤</button>
      <button class="choice ghost" data-s="1" type="button">ì•„ë‹ˆë‹¤</button>
      <button class="choice ghost" data-s="0" type="button">ì „í˜€ ì•„ë‹ˆë‹¤</button>`;

    // ì´ì „ ì„ íƒ ë³µì›
    const prevSel = ans[idx];
    if(prevSel !== undefined){
      Array.from(wrap.children).forEach(b=>{
        if(Number(b.dataset.s)===prevSel) b.classList.add('selected');
      });
    }

    // í´ë¦­
    Array.from(wrap.children).forEach(btn=>{
      btn.addEventListener('click', ()=>{
        Array.from(wrap.children).forEach(c=>c.classList.remove('selected'));
        btn.classList.add('selected');
        setTimeout(()=>choose(Number(btn.dataset.s)), 150);
      });
    });

    startTime = Date.now();
  }

  function choose(s){
    const elapsed = (Date.now() - startTime)/1000;
    times[idx] = elapsed;

    const k = Q[idx].k;
    const w = getWeight(elapsed);         // 0.85 ~ 1.15
    ans[idx] = s;

    // ì„ íƒ ìš°ì„  + ì‹œê°„ ë³´ì¡°(Â±20% ìº¡ ë‚´ë¶€ì—ì„œ 0.85~1.15ë§Œ ì‚¬ìš©)
    const adjusted = s + (s * (w - 1) * 0.2);
    score[k] += adjusted;
    count[k] += 1;

    next();
  }

  function next(){
    idx++;
    if(idx < Q.length) render();
    else finish();
  }

  prevBtn?.addEventListener('click', ()=>{
    if(idx===0) return;
    idx--;
    recalc(idx);
    render();
  });

  skipBtn?.addEventListener('click', ()=>{
    ans[idx]=0;
    times[idx]=(Date.now()-startTime)/1000;
    next();
  });

  function recalc(end){
    score.W=score.V=score.R=score.I=0;
    count.W=count.V=count.R=count.I=0;
    for(let i=0;i<end;i++){
      const s = ans[i] ?? 0;
      const k = Q[i].k;
      const w = getWeight(times[i] ?? 0);
      const adjusted = s + (s * (w - 1) * 0.2);
      score[k] += adjusted;
      count[k] += 1;
    }
  }

  function getWeight(sec){
    // ë„ˆë¬´ ë¹ ë¥´ë©´ -15, ë³´í†µ 1.0, ì¶©ë¶„íˆ ìˆ™ê³ í•˜ë©´ +15 (ìµœëŒ€ ë³´ì¡°)
    if(sec < 1)  return 0.85;
    if(sec < 4)  return 1.00;
    if(sec < 8)  return 1.10;
    return 1.15;
  }

  // ---- ë¶„ë¥˜ ê·œì¹™ ----
  function normalize(sc){
    // 5ì§€ì„ ë‹¤ ìµœëŒ€ 4ì , ì¶•ë³„ ë¬¸í•­ ìˆ˜ ë°˜ì˜
    const max = 4;
    const Wn = count.W ? sc.W / (count.W*max) : 0;
    const Vn = count.V ? sc.V / (count.V*max) : 0;
    const Rn = count.R ? sc.R / (count.R*max) : 0;
    const In = count.I ? sc.I / (count.I*max) : 0;
    return {W:Wn, V:Vn, R:Rn, I:In};
  }

  function classify(n){ // n: 0~1
    // ìš°ì„  ê·œì¹™(ê°•ë„í˜•) â†’ ì¼ë°˜ ê·œì¹™
    if(n.V >= 0.70 && n.R <= 0.40)         return 'STORMY';   // ì˜ˆë¯¼í˜•(ê°•í•œ ë³€í™” + ë‚®ì€ íšŒë³µ)
    if(n.R >= 0.70 && n.V <= 0.40 && n.W >= 0.60) return 'SUNNY';    // ë§‘ìŒí˜•(íšŒë³µâ†‘, ë³€í™”â†“, ë”°ëœ»í•¨â†‘)
    if(n.I >= 0.65 && n.V <= 0.50)         return 'MOONLIT';  // ë‚´ë©´í˜•(ê³ ìš”â†‘, ë³€í™”â†“)
    if(n.R <= 0.45 && n.W >= 0.50)         return 'RAINY';    // ê°ì„±í˜•(ë”°ëœ»í•¨â†‘, íšŒë³µâ†“)
    if(n.V >= 0.60)                        return 'VARIABLE'; // ë³€í™”í˜•(ë³€í™”â†‘)
    return 'MILD'; // ì˜¨í™”í˜•(ê·¸ ì™¸)
  }

  const COPY = {
    SUNNY: {
      icon:'ğŸŒ', title:'ë§‘ìŒí˜• â€” ë”°ëœ»í•¨ê³¼ íšŒë³µì˜ í–‡ì‚´',
      long: [
        'ë‹¹ì‹ ì˜ ë§ˆìŒì€ ê¸°ë³¸ì ìœ¼ë¡œ í¬ê·¼í•œ ì˜¨ë„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. ê°ì •ì˜ íŒŒë„ê°€ ì˜¤ë”ë¼ë„ ê¸ˆì„¸ ìˆ¨ì„ ê³ ë¥´ë©° ì¤‘ì‹¬ì„ ì°¾ëŠ” í˜ì´ ìˆì–´ìš”. ê·¸ë˜ì„œ ì£¼ë³€ ì‚¬ëŒë“¤ì€ ë‹¹ì‹ ê³¼ í•¨ê»˜ ìˆì„ ë•Œ ë§ˆìŒì´ í–‡ë³•ì„ ì¬ëŠ” ë“¯ ë”°ëœ»í•˜ë‹¤ê³  ëŠë‚ë‹ˆë‹¤.',
        'ë‹¹ì‹ ì˜ ì¥ì ì€ â€œë¹ ë¥¸ íšŒë³µâ€ê³¼ â€œë‹¤ì •í•œ íƒœë„â€ì…ë‹ˆë‹¤. ì‹¤ìˆ˜ë‚˜ ë¶€ë‹´ì´ ìƒê²¨ë„ ìì‹ ì„ ê³¼í•˜ê²Œ ëª°ì•„ë¶™ì´ê¸°ë³´ë‹¤, ìƒí™©ì„ ì •ë¦¬í•˜ê³  í•„ìš”í•œ ë„ì›€ì„ ìš”ì²­í•  ì¤„ ì•Œì•„ìš”. ì´ ë¶€ë“œëŸ¬ìš´ ìê¸° ëŒ€í™”ëŠ” ì¥ê¸°ì ìœ¼ë¡œ í° ì•ˆì •ê°ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.',
        'ê°€ë”ì€ â€œê´œì°®ì•„ ë³´ì—¬ì•¼ í•œë‹¤â€ëŠ” ì±…ì„ê°ì´ ë§ˆìŒì„ ì¡°ìš©íˆ ë¬´ê²ê²Œ ë§Œë“¤ê¸°ë„ í•´ìš”. í–‡ì‚´ì—ë„ ê·¸ëŠ˜ì´ ìˆë“¯, ë‚˜ë§Œì˜ ì‰¼ì„ í™•ë³´í•˜ê³  ì§„ì§œ ê°ì •ì„ í„¸ì–´ë†“ëŠ” ì•ˆì „ì§€ëŒ€ë¥¼ ê¾¸ì¤€íˆ ì±™ê²¨ë³´ì„¸ìš”.'
      ],
      tips:['í•˜ë£¨ ë§ˆë¬´ë¦¬ 5ë¶„ í˜¸í¡/ìŠ¤íŠ¸ë ˆì¹­','â€œê´œì°®ì§€ ì•Šì•„ë„ ê´œì°®ì•„â€ ë¬¸ì¥ ì—°ìŠµ','ê°€ë²¼ìš´ ì‚°ì±… + í–‡ë³• ì¬ê¸° 10ë¶„','ë„ì›€ ìš”ì²­ ë¦¬ìŠ¤íŠ¸(3ëª…) ë§Œë“¤ì–´ë‘ê¸°']
    },
    MILD: {
      icon:'ğŸŒ¤ï¸', title:'ì˜¨í™”í˜• â€” ë¶€ë“œëŸ¬ìš´ ê· í˜• ê°ê°',
      long: [
        'ë‹¹ì‹ ì€ ê°ì •ê³¼ ìƒê°ì„ ë¬´ë¦¬ ì—†ì´ ì¡°ìœ¨í•´ ê°€ëŠ” ì‚¬ëŒì…ë‹ˆë‹¤. í° íŒŒë„ê°€ ì•„ë‹ˆë”ë¼ë„, ì‘ì€ ë¬¼ê²°ì„ ì˜ ì½ê³  ê·¸ì— ë§ëŠ” ì†ë„ë¡œ ì›€ì§ì—¬ìš”. ê·¸ë˜ì„œ ê´€ê³„ì—ì„œë„ â€œí•¨ê»˜ ìˆìœ¼ë©´ í¸ì•ˆí•˜ë‹¤â€ëŠ” ë§ì„ ë“£ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.',
        'ì˜¨í™”í•¨ì€ ê²°ì½” ì†Œê·¹ì ì´ë¼ëŠ” ëœ»ì´ ì•„ë‹ˆì—ìš”. ì˜¤íˆë ¤ ì£¼ë³€ì˜ ë¦¬ë“¬ì„ ê³ ë ¤í•˜ëŠ” ë°°ë ¤ì—ì„œ ë‚˜ì˜¤ì£ . ì´ëŸ° ì‚¬ëŒì—ê²Œ í•„ìš”í•œ ê±´ â€œë‚´ ë§ˆìŒì˜ ì†ë„â€ë¥¼ ë¨¼ì € ë“£ëŠ” ì—°ìŠµì…ë‹ˆë‹¤.',
        'ë•Œë•Œë¡œ íƒ€ì¸ì˜ ìš”êµ¬ë¥¼ ë°›ì•„ì£¼ë‹¤ ë³´ë©´, ë‚´ ë§ˆìŒì˜ ì‹ í˜¸ê°€ íë¦¿í•´ì§ˆ ìˆ˜ ìˆì–´ìš”. ì¤‘ìš”í•œ ì„ íƒ ì•ì—ì„  í•œ ë°•ì ì‰¬ì–´ê°€ë©° â€œì§€ê¸ˆ ë‚´ê°€ ì§„ì§œ ì›í•˜ëŠ” ê²ƒâ€ì„ ì ì–´ë³´ì„¸ìš”.'
      ],
      tips:['ì„ íƒ ì „ 60ì´ˆ ë©ˆì¶¤(íƒ€ì´ë¨¸)','ì£¼ 1íšŒ â€œë‚˜ë§Œì˜ ì¼ì •â€ì— ìê¸°ì‚¬ì—…(ì·¨ë¯¸/ìš´ë™) ë„£ê¸°','ê±°ì ˆ ë¬¸ì¥ í…œí”Œë¦¿ 1ê°œ ë§Œë“¤ê¸°','ì£¼ê°„ ì—ë„ˆì§€ ì§€ë„(ì–¸ì œ í”¼ê³¤/ë§‘ìŒ?) ê·¸ë ¤ë³´ê¸°']
    },
    VARIABLE: {
      icon:'ğŸŒ¦ï¸', title:'ë³€í™”í˜• â€” ì‚´ì•„ìˆëŠ” ê°ì •ì˜ ê³„ì ˆ',
      long: [
        'ë‹¹ì‹ ì˜ ê°ì •ì€ ê³„ì ˆì²˜ëŸ¼ ìì£¼ ë°”ë€ë‹ˆë‹¤. ê¸°ë³µì´ ìˆë‹¤ëŠ” ê±´, ê·¸ë§Œí¼ ì‚¶ì„ ìƒìƒíˆ ëŠë¼ê³  ìˆë‹¤ëŠ” ëœ»ì´ê¸°ë„ í•´ìš”. ìƒˆë¡œìš´ ìê·¹ì— ë°˜ì‘í•˜ê³ , ë‹¤ì±„ë¡œìš´ ê°ì •ì„ ê²½í—˜í•˜ëŠ” ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.',
        'ë‹¤ë§Œ ë³€í™”ê°€ ì¦ì„ìˆ˜ë¡ ì²´ë ¥ê³¼ ë§ˆìŒì˜ ì—°ë£Œê°€ ë¹¨ë¦¬ ì†Œëª¨ë¼ìš”. ê·¸ë˜ì„œ â€œì¶©ì „ ë£¨í‹´â€ì´ íŠ¹íˆ ì¤‘ìš”í•©ë‹ˆë‹¤. ê·œì¹™ì„ ê°•ìš”í•  í•„ìš”ëŠ” ì—†ì§€ë§Œ, ìµœì†Œí•œì˜ ë¦¬ë“¬(ìˆ˜ë©´/ì‹ì‚¬/ìˆ˜ë¶„/ì‚°ì±…)ì„ ê³ ì •í•´ë‘ë©´ ê°ì •ì˜ ì§„í­ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.',
        'ë‹¹ì‹ ì˜ ê°ì •ì€ ì˜ëª»ì´ ì•„ë‹ˆë¼, ì‚´ì•„ìˆìŒì˜ ì¦ê±°ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì˜ ë‚ ì”¨ë¥¼ ì¸ì •í•˜ê³ , ê·¸ì— ë§ëŠ” ì˜·ì„ ì…ë“¯ í–‰ë™ì„ ì¡°ì ˆí•´ë³´ì„¸ìš”.'
      ],
      tips:['ìˆ˜ë©´Â·ì‹ì‚¬Â·ìˆ˜ë¶„ â€œë¦¬ë“¬ 4ì¢…â€ ê³ ì •','í•˜ë£¨ 10ë¶„ í–‡ë¹› + 10ë¶„ ê±·ê¸°','ê°ì • ê¸°ë¡(3ì¤„ ì €ë„): ì‚¬ê±´/ê°ì •/ìš”êµ¬','ê³¼í•œ ì•½ì†ì€ 1ê°œ ì¤„ì´ê¸°']
    },
    RAINY: {
      icon:'ğŸŒ§ï¸', title:'ê°ì„±í˜• â€” ë¹„ë¥¼ ë§ì•„ë„ ìë¼ë‚˜ëŠ” ë§ˆìŒ',
      long: [
        'ë‹¹ì‹ ì€ ê°ì •ì„ ì–µì§€ë¡œ ë°€ì–´ë‚´ì§€ ì•Šê³ , ìˆëŠ” ê·¸ëŒ€ë¡œ ëŠë¼ëŠ” ìš©ê¸°ê°€ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë•Œë¡œëŠ” ë¹„ë¥¼ ë§ëŠ” ì‹œê°„ì´ ê¸¸ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆì§€ë§Œ, ê·¸ë§Œí¼ ë‚¨ì˜ ë§ˆìŒë„ ê¹Šê²Œ ì´í•´í•˜ëŠ” ì‚¬ëŒì…ë‹ˆë‹¤.',
        'ê°ì •ì´ ë¬´ê±°ìš¸ìˆ˜ë¡, í˜¼ìê°€ ë˜ë ¤ëŠ” ë§ˆìŒì´ ì»¤ì§ˆ ìˆ˜ ìˆì–´ìš”. ê·¸ëŸ¬ë‚˜ ë¹„ ì˜¤ëŠ” ë‚ ì¼ìˆ˜ë¡ ì§€ë¶•ì´ ë” í•„ìš”í•˜ë“¯, ì•ˆì „í•œ ëŒ€í™” ìƒëŒ€ì™€ì˜ ì—°ê²°ì´ íšŒë³µë ¥ì„ í¬ê²Œ ë†’ì—¬ì¤ë‹ˆë‹¤.',
        'â€œê°ì •ì€ í˜ëŸ¬ê°„ë‹¤â€ëŠ” ì‚¬ì‹¤ì„ ê¸°ì–µí•´ ì£¼ì„¸ìš”. ì˜¤ëŠ˜ì˜ ë¹„ê°€ ë‚´ì¼ì˜ ì‹¹ì„ í‚¤ìš¸ ë•Œê°€ ë§ìŠµë‹ˆë‹¤.'
      ],
      tips:['ê°ì • ë¼ë²¨ë§(ìŠ¬í””/ì™¸ë¡œì›€/ë¶„ë…¸ ë“± ì´ë¦„ ë¶™ì´ê¸°)','ë”°ëœ»í•œ ì°¨/ìƒ¤ì›Œ ê°™ì€ ê°ê° ì¼€ì–´','ì‹ ë¢°í•˜ëŠ” ì‚¬ëŒ 1ëª…ì—ê²Œ ì†”ì§ ë©”ì„¸ì§€','ì¼ê¸° ëŒ€ì‹  â€œê°ì • ìƒ‰ì¹ í‘œâ€ë¡œ ê°€ë³ê²Œ']
    },
    STORMY: {
      icon:'ğŸŒ©ï¸', title:'ì˜ˆë¯¼í˜• â€” ì˜ˆë¦¬í•œ ê°ê°, ì„¬ì„¸í•œ ë§ˆìŒ',
      long: [
        'ë‹¹ì‹ ì€ ë³€í™”ì— ë¯¼ê°í•˜ê³ , ì‘ì€ ì‹ í˜¸ë„ í¬ê²Œ ê°ì§€í•©ë‹ˆë‹¤. ì´ ì˜ˆë¦¬í•¨ì€ ë•Œë¡œ í”¼ê³¤í•¨ì„ ë§Œë“¤ì§€ë§Œ, ì‚¬ì‹¤ì€ â€œì„¬ì„¸í•¨â€ì´ë¼ëŠ” ê°•ì ì˜ ë‹¤ë¥¸ ì–¼êµ´ì´ì—ìš”.',
        'ì‰½ê²Œ í”ë“¤ë¦¬ê¸°ë§Œ í•˜ëŠ” ë§ˆìŒì€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë§Œ, íšŒë³µì„ ë•ëŠ” êµ¬ì¡°(ìˆ˜ë©´/ì˜ì–‘/ì›€ì§ì„/ëŒ€í™”)ê°€ ì•„ì§ ì¶©ë¶„í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´ìš”. ìŠ¤ìŠ¤ë¡œë¥¼ íƒ“í•˜ê¸°ë³´ë‹¤, í™˜ê²½ì„ ì¡°ì •í•˜ëŠ” ë° ì§‘ì¤‘í•´ë³´ì„¸ìš”.',
        'â€œì˜ˆë¯¼í•¨â€ì€ ì¡°ì ˆë  ë•Œ ê°•ë ¥í•œ ëŠ¥ë ¥ì´ ë©ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ê°ê°ì€ ëˆ„êµ°ê°€ì˜ ì•ˆì „ì„ ì§€í‚¤ê³ , ë¶„ìœ„ê¸°ë¥¼ ë°”ê¾¸ëŠ” ë””í…Œì¼ì„ ë°œê²¬í•´ì¤„ ê±°ì˜ˆìš”.'
      ],
      tips:['ìˆ˜ë©´ ìš°ì„ (ì‹œê°„ ê³ ì •) + ì¹´í˜ì¸ ì ˆë°˜ìœ¼ë¡œ','SNS/ë‰´ìŠ¤ ë…¸ì¶œ ì‹œê°„ ì œí•œ','ë¶ˆì•ˆì„ ëª¸ìœ¼ë¡œ ë¹¼ê¸°(ë°•ìˆ˜Â·ê°€ë²¼ìš´ ìŠ¤ì¿¼íŠ¸ 1ë¶„)','ì „ë¬¸ê°€ ìƒë‹´/ë©˜í† ë§ íƒìƒ‰ ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°']
    },
    MOONLIT: {
      icon:'ğŸŒ™', title:'ë‚´ë©´í˜• â€” ê³ ìš” ì†ì—ì„œ ìë¼ëŠ” ë¹›',
      long: [
        'ë‹¹ì‹ ì€ ê³ ìš”í•œ ê³µê°„ì—ì„œ í˜ì„ ì–»ê³ , ê°ì •ì„ ë‹¤ë“¬ìŠµë‹ˆë‹¤. í˜¼ì ìˆëŠ” ì‹œê°„ì´ ë¶€ì¡±í•˜ë©´ ë§ˆìŒì´ ë¹ ë¥´ê²Œ í”¼ë¡œí•´ì§ˆ ìˆ˜ ìˆì–´ìš”. ê·¸ë˜ì„œ ë‹¹ì‹ ì—ê² â€œê³ ìš”ì˜ ì‹œê°„â€ì´ ë‹¨ìˆœí•œ ì·¨í–¥ì´ ì•„ë‹ˆë¼, íšŒë³µì„ ìœ„í•œ í•„ìˆ˜ ì¡°ê±´ì…ë‹ˆë‹¤.',
        'ìê¸° ì´ì•¼ê¸°ë¥¼ ê¸€ë¡œ ì •ë¦¬í•˜ê±°ë‚˜ ê·¸ë¦¼/ìŒì•…ìœ¼ë¡œ í‘œí˜„í•˜ëŠ” í™œë™ì´ í° ë„ì›€ì„ ì¤ë‹ˆë‹¤. ë‚´ë©´ì˜ ì†Œë¦¬ë¥¼ ì„ ëª…í•˜ê²Œ ë“£ê³ , í•„ìš”í•œ ê²ƒê³¼ ë‚´ë ¤ë†“ì„ ê²ƒì„ êµ¬ë¶„í•˜ê²Œ ë˜ì£ .',
        'ì„¸ìƒê³¼ ê±°ë¦¬ë¥¼ ë‘ëŠ” ê±´ ë„ë§ì´ ì•„ë‹ˆë¼ ì„ íƒì¼ ë•Œ ë” ë‹¨ë‹¨í•´ì§‘ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì†ë„ë¥¼ ì§€í‚¤ë©° ì´ì–´ì§€ëŠ” ì—°ê²°ì€ ì˜¤ë˜ê°‘ë‹ˆë‹¤.'
      ],
      tips:['í•˜ë£¨ 15ë¶„ â€œë¬´ì†ŒìŒ ë¸”ë¡â€ í™•ë³´','ìê¸°ê¸°ë¡(ë…¸íŠ¸/ì•±) í…œí”Œë¦¿ ë§Œë“¤ê¸°','ì†ŒìŒ ëŒ€ì‹  ë°±ìƒ‰ì†ŒìŒ/ìì—°ì†Œë¦¬','ì†Œìˆ˜ ì¹œë°€ëª¨ì„(1~2ëª…)ë§Œ ì¼ì •í™”']
    }
  };

  function meters(n){
    const items = [
      {k:'W', name:'ë”°ëœ»í•¨'},
      {k:'V', name:'ë³€í™”ë„'},
      {k:'R', name:'íšŒë³µë ¥'},
      {k:'I', name:'ê³ ìš”'}
    ];
    return items.map(({k,name})=>{
      const pct = Math.round((n[k]||0)*100);
      return `<div style="text-align:left;margin:6px 0">
        <div style="display:flex;justify-content:space-between;font-weight:700">
          <span>${name}</span><span>${pct}%</span>
        </div>
        <div style="height:8px;background:var(--mint-200);border-radius:999px;overflow:hidden">
          <span style="display:block;height:100%;width:${pct}%;background:var(--mint-500)"></span>
        </div>
      </div>`;
    }).join('');
  }

  function finish(){
    card.style.display='none';
    barFill.style.width='100%';

    const n = normalize(score);
    const key = classify(n);
    const c = COPY[key];

    const html = `
      <div class="result-card">
        <div class="result-hero">
          <img src="../assets/weather.png" alt="ë§ˆìŒ ê¸°ìƒì˜ˆë³´" onerror="this.style.display='none'">
          <div>
            <div class="result-title">${c.icon} ${c.title}</div>
            <div class="result-desc">â€œì§€ê¸ˆì˜ ë‚˜ë¥¼ ê°€ë³ê²Œ ì´í•´í•˜ê³ , ë‹¤ë£¨ëŠ” ë²•ì„ ì—°ìŠµí•´ìš”.â€</div>
          </div>
        </div>

        <p style="margin:8px 0">${c.long[0]}</p>
        <p style="margin:8px 0">${c.long[1]}</p>
        <p style="margin:8px 0">${c.long[2]}</p>

        <div style="margin-top:10px">${meters(n)}</div>

        <div style="margin-top:10px">
          ${c.tips.map(t=>`<div class="pill">${t}</div>`).join('')}
        </div>

        <div class="result-actions">
          <a class="start" href="../index.html">ë©”ì¸ìœ¼ë¡œ</a>
          <button class="start" onclick="location.reload()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>
        </div>
      </div>
    `;

    resultBox.innerHTML = html;
    resultBox.style.display = 'block';
  }

  // ì‹œì‘
  render();
});