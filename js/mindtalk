/* ===================================================
 * ë‚´ê°€ ë‚˜ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì€? (5ì§€ì„ ë‹¤ + ì‹œê°„ ê°€ì¤‘ì¹˜ Â±20%)
 * ---------------------------------------------------
 * - ë‹µë³€: 0~4 (ì „í˜€ ì•„ë‹ˆë‹¤ / ì•„ë‹ˆë‹¤ / ë³´í†µ / ê·¸ë ‡ë‹¤ / ë§¤ìš° ê·¸ë ‡ë‹¤)
 * - ì„ íƒ ì ìˆ˜ ìš°ì„ , ì‘ë‹µì‹œê°„ì€ ë³´ì¡°(Â±20% ìº¡, ë’¤ì—ì§€ ì•ŠìŒ)
 * - ë¶„ë¥˜: 6ìœ í˜• (ìœ„ë¡œ/ë‹¤ë…/ê²©ë ¤/ì •ë¦¬/ì§‘ì¤‘/ì¬ì‹œì‘)
 * - ê²°ê³¼ í™”ë©´: ì ìˆ˜/ìˆ«ì ë¯¸ë…¸ì¶œ â†’ ìƒíƒœ ì„¤ëª… + ë§ˆìŒ ë¦¬ë§ˆì¸ë“œ + ë°°ì§€í˜• ìš”ì•½
 * =================================================== */

document.addEventListener('DOMContentLoaded', () => {
  const Q = [
    // R : Reassure(ìœ„ë¡œ) â€” ë”°ëœ»í•œ ì•ˆì‹¬, ìˆ˜ìš©
    {k:'R', q:'ì˜¤ëŠ˜ì˜ ë‚˜ëŠ” â€œê´œì°®ì•„, ì—¬ê¸°ê¹Œì§€ë„ ì˜ ì™”ì–´â€ë¼ëŠ” ë§ì„ ë“£ê³  ì‹¶ë‹¤.'},
    {k:'R', q:'ì‹¤ìˆ˜/ì§€ì—°ì´ ìˆì–´ë„ ìŠ¤ìŠ¤ë¡œë¥¼ ì´í•´í•˜ë ¤ëŠ” í¸ì´ë‹¤.'},
    // C : Compassion(ë‹¤ë…) â€” ìê¸°ì—°ë¯¼, ë¶€ë“œëŸ¬ìš´ í†¤
    {k:'C', q:'ìš”ì¦˜ì˜ ë‚˜ëŠ” ë‚´ ë§ˆìŒì„ í† ë‹¥ì´ëŠ” ë¬¸ì¥ì´ í•„ìš”í•˜ë‹¤.'},
    {k:'C', q:'ë‚´ ê°ì •ì„ ìˆëŠ” ê·¸ëŒ€ë¡œ ì¸ì •í•˜ëŠ” í¸ì´ë‹¤.'},
    // E : Encourage(ê²©ë ¤) â€” ì—ë„ˆì§€/ìš©ê¸°/í•œ ê±¸ìŒ
    {k:'E', q:'ì‘ê²Œë¼ë„ â€œì‹œì‘í•˜ì!â€ ê°™ì€ ë°€ì–´ì£¼ëŠ” ë§ì´ ë„ì›€ì´ ëœë‹¤.'},
    {k:'E', q:'ë‚´ê°€ ì •í•œ ëª©í‘œë¥¼ í–¥í•´ ë‹¤ì‹œ ë‹¬ë ¤ë³´ê³  ì‹¶ë‹¤.'},
    // G : Ground(ì •ë¦¬) â€” êµ¬ì¡°/ì •ëˆ/ìš°ì„ ìˆœìœ„
    {k:'G', q:'ë¨¸ë¦¿ì†ì„ ì •ë¦¬í•˜ê³  ìš°ì„ ìˆœìœ„ë¥¼ ë‹¤ì‹œ ì„¸ìš°ê³  ì‹¶ë‹¤.'},
    {k:'G', q:'í•  ì¼ì„ ì‘ì€ ë‹¨ìœ„ë¡œ ìª¼ê°œë©´ ë§ˆìŒì´ ê°€ë²¼ì›Œì§„ë‹¤.'},
    // F : Focus(ì§‘ì¤‘) â€” ì‚°ë§Œ íšŒìˆ˜, ëª°ì…
    {k:'F', q:'ì‚°ë§Œí•¨ì„ ì¤„ì´ê³  í•µì‹¬ì—ë§Œ ì§‘ì¤‘í•˜ê³  ì‹¶ë‹¤.'},
    {k:'F', q:'ì‰¬ìš´ ì¼ë¶€í„° ëª°ì•„ì¹˜ë©´ ëª°ì…ì´ ì‚´ì•„ë‚œë‹¤.'},
    // B : Begin(ì¬ì‹œì‘) â€” ë¦¬ì…‹/ì²˜ìŒì²˜ëŸ¼/ìƒˆ íŒ
    {k:'B', q:'ìƒˆ í˜ì´ì§€ë¥¼ ì—¬ëŠ” ë§ˆìŒìœ¼ë¡œ ë‹¤ì‹œ ì‹œì‘í•˜ê³  ì‹¶ë‹¤.'},
    {k:'B', q:'ê³¼ê±°ëŠ” ì ‘ì–´ë‘ê³  ì˜¤ëŠ˜ì˜ í•œ ì¹¸ë¶€í„° ì±„ìš°ê³  ì‹¶ë‹¤.'},
    // í˜¼í•© ì„±í–¥ í™•ì¸ìš©(ê° ì¶• ë³´ì¡° ì‹ í˜¸)
    {k:'R', q:'ìš”ì¦˜ ë‚´ê²Œ ê°€ì¥ í•„ìš”í•œ ê±´ â€œê±±ì • ë§ìâ€ëŠ” ìˆ¨ ê³ ë¥´ê¸°ë‹¤.'},
    {k:'E', q:'ìŠ¤ìŠ¤ë¡œë¥¼ ë¶ë‹ëŠ” í•œë§ˆë””ê°€ ë‚´ ë°œê±¸ìŒì„ ê°€ë³ê²Œ í•œë‹¤.'},
    {k:'G', q:'ì •ë¦¬ëœ ì¼ì •í‘œë§Œ ìˆì–´ë„ ë§ˆìŒì´ í•œê²° í¸í•˜ë‹¤.'}
  ]; // ì´ 15ë¬¸í•­

  const stepLabel = document.getElementById('stepLabel');
  const barFill   = document.getElementById('barFill');
  const qText     = document.getElementById('qText');
  const wrap      = document.getElementById('choiceWrap');
  const card      = document.getElementById('card');
  const resultBox = document.getElementById('result');
  const prevBtn   = document.getElementById('prev');
  const skipBtn   = document.getElementById('skip');

  let idx = 0;
  const ans   = [];                 // ì›ì ìˆ˜(0~4)
  const times = [];                 // ì‘ë‹µì‹œê°„(ì´ˆ)
  let startTime = Date.now();

  const score  = {R:0,C:0,E:0,G:0,F:0,B:0};
  const counts = {R:0,C:0,E:0,G:0,F:0,B:0};

  function render(){
    stepLabel.textContent = `${idx+1} / ${Q.length}`;
    barFill.style.width   = `${(idx/Q.length)*100}%`;
    qText.textContent     = Q[idx].q;

    wrap.innerHTML = `
      <button class="choice" data-s="4" type="button">ë§¤ìš° ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="3" type="button">ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="2" type="button">ë³´í†µì´ë‹¤</button>
      <button class="choice ghost" data-s="1" type="button">ì•„ë‹ˆë‹¤</button>
      <button class="choice ghost" data-s="0" type="button">ì „í˜€ ì•„ë‹ˆë‹¤</button>
    `;

    const prevSel = ans[idx];
    if(prevSel !== undefined){
      Array.from(wrap.children).forEach(b=>{
        if(Number(b.dataset.s)===prevSel) b.classList.add('selected');
      });
    }

    Array.from(wrap.children).forEach(btn=>{
      btn.addEventListener('click', ()=>{
        Array.from(wrap.children).forEach(c=>c.classList.remove('selected'));
        btn.classList.add('selected');
        setTimeout(()=>choose(Number(btn.dataset.s)), 160);
      });
    });

    startTime = Date.now();
  }

  function getWeight(sec){
    // 0.8~1.2 ë²”ìœ„, ì„ íƒì€ ì ˆëŒ€ ìš°ì„ 
    if(sec < 1)  return 0.9;
    if(sec < 4)  return 1.0;
    if(sec < 8)  return 1.15;
    return 1.1;
  }

  function choose(s){
    const elapsed = (Date.now()-startTime)/1000;
    times[idx] = elapsed;

    const k = Q[idx].k;
    const w = getWeight(elapsed);

    ans[idx] = s;
    const adjusted = s + (s * (w - 1) * 0.2); // ë³´ì¡°(Â±20% ìº¡)
    score[k]  += adjusted;
    counts[k] += 1;

    next();
  }

  function next(){
    idx++;
    if(idx < Q.length) render();
    else finish();
  }

  prevBtn?.addEventListener('click', ()=>{
    if(idx===0) return;
    idx--;
    recalc(idx);
    render();
  });

  skipBtn?.addEventListener('click', ()=>{
    ans[idx]   = 0;
    times[idx] = (Date.now()-startTime)/1000;
    next();
  });

  function recalc(end){
    // ë˜ëŒì•„ê° ì•ˆì „ì¬ê³„ì‚°
    for(const k of Object.keys(score)){ score[k]=0; counts[k]=0; }
    for(let i=0;i<end;i++){
      const s = ans[i] ?? 0;
      const k = Q[i].k;
      const w = getWeight(times[i] ?? 0);
      const adjusted = s + (s * (w - 1) * 0.2);
      score[k]  += adjusted;
      counts[k] += 1;
    }
  }

  /* ---------- ë¶„ë¥˜ ë¡œì§ ---------- */
  const TYPES = {
    R: { key:'R', title:'â˜ï¸ ìœ„ë¡œí˜•',     quote:'â€œì§€ê¸ˆì˜ ë„ˆë„ ì¶©ë¶„í•´.â€' },
    C: { key:'C', title:'ğŸŒ¿ ë‹¤ë…í˜•',     quote:'â€œëŠê¸‹í•˜ê²Œ, ë‚´ í¸ìœ¼ë¡œ.â€' },
    E: { key:'E', title:'â˜€ï¸ ê²©ë ¤í˜•',     quote:'â€œì‘ê²Œë¼ë„, ì§€ê¸ˆ ì‹œì‘!â€' },
    G: { key:'G', title:'ğŸ“‹ ì •ë¦¬í˜•',     quote:'â€œì •ëˆí•˜ë©´ ë§ˆìŒë„ ê°€ë²¼ì›Œì ¸.â€' },
    F: { key:'F', title:'ğŸ¯ ì§‘ì¤‘í˜•',     quote:'â€œí•µì‹¬ í•œ ê°€ì§€ì— ëª°ì….â€' },
    B: { key:'B', title:'ğŸ”„ ì¬ì‹œì‘í˜•',   quote:'â€œì˜¤ëŠ˜ í˜ì´ì§€ë¶€í„° ìƒˆë¡œ.â€' },
    // ì¡°í•©(ìƒìœ„ 2ê°œ, ì•ŒíŒŒë²³ìˆœ ë³‘í•©í‚¤)
    'C+R': { key:'CR', title:'â˜ï¸ğŸŒ¿ ìœ„ë¡œâ€“ë‹¤ë…í˜•', quote:'â€œê´œì°®ë‹¤ê³  ë§í•´ì£¼ê³ , ë‚´ ì–´ê¹¨ë¥¼ í† ë‹¥.â€' },
    'E+B': { key:'EB', title:'â˜€ï¸ğŸ”„ ê²©ë ¤â€“ì¬ì‹œì‘í˜•', quote:'â€œì§€ê¸ˆë¶€í„°ì˜ í•œ ê±¸ìŒ.â€' },
    'G+F': { key:'GF', title:'ğŸ“‹ğŸ¯ ì •ë¦¬â€“ì§‘ì¤‘í˜•', quote:'â€œì •ëˆí•˜ê³  ì°Œë¦¿, í•œ ì ìœ¼ë¡œ.â€' },
    'R+E': { key:'RE', title:'â˜ï¸â˜€ï¸ ìœ„ë¡œâ€“ê²©ë ¤í˜•', quote:'â€œë¨¼ì € ì•ˆì‹¬, ì´ì–´ì„œ ì¶”ì§„.â€' },
    'C+G': { key:'CG', title:'ğŸŒ¿ğŸ“‹ ë‹¤ë…â€“ì •ë¦¬í˜•', quote:'â€œë¶€ë“œëŸ½ê²Œ ê°ì‹¸ê³ , ì¡°ìš©íˆ ì •ëˆ.â€' },
    'F+B': { key:'FB', title:'ğŸ¯ğŸ”„ ì§‘ì¤‘â€“ì¬ì‹œì‘í˜•', quote:'â€œí•µì‹¬ë§Œ ì¥ê³  ìƒˆë¡œ ì‹œì‘.â€' },
  };

  const LONG = {
    R: `ë§ˆìŒì˜ ì˜¨ë„ë¥¼ ìµœì €ì¹˜ë¡œ ë‚®ì¶”ì§€ ì•Šê³  ì§€ì¼œë‚´ëŠ” ëŠ¥ë ¥ì´ ì¢‹ì•„ìš”. 
ë¶€ì¡±í–ˆë˜ ë‚ ì—ë„ â€œì—¬ê¸°ê¹Œì§€ ì˜¨ ë‚˜â€ë¥¼ í¬ê¸°í•˜ì§€ ì•ŠëŠ” íƒœë„ê°€ ë‹¹ì‹ ì˜ ì•ˆì „ë§ì´ì—ìš”. 
ì§€ê¸ˆ í•„ìš”í•œ ë§ì€ ë¹„êµë‚˜ ì••ë°•ì´ ì•„ë‹ˆë¼ â€œê´œì°®ì•„, ë‹¤ìŒ ì¥ë©´ìœ¼ë¡œ ê°€ìâ€ë¼ëŠ” ì•ˆì‹¬ì´ì—ìš”.`,
    C: `ë‹¹ì‹ ì€ ìŠ¤ìŠ¤ë¡œì˜ ë§ˆìŒì„ ë‹¤ì •í•˜ê²Œ ëŒë³¼ ì¤„ ì•„ëŠ” ì‚¬ëŒì…ë‹ˆë‹¤. 
ê°ì •ì„ ë°€ì–´ë‚´ì§€ ì•Šê³  í’ˆì— ì˜¬ë ¤ë†“ì„ ë•Œ íšŒë³µë ¥ì´ ìë¼ìš”. 
ì¡°ê¸‰í•¨ ëŒ€ì‹  ì†ë„ ì¡°ì ˆâ€”ì´ê²Œ ë‹¹ì‹ ì˜ í˜ì´ìŠ¤ë¥¼ ì§€ì¼œì¤ë‹ˆë‹¤.`,
    E: `ë‹¹ì‹ ì˜ ì—ë„ˆì§€ëŠ” â€œì‘ì€ ì¶œë°œâ€ì—ì„œ ê°€ì¥ ì˜ ì‚´ì•„ë‚©ë‹ˆë‹¤. 
ì™„ë²½í•œ ê³„íšë³´ë‹¤ 10ë¶„ì˜ í–‰ë™, 1ì¤„ì˜ ê¸°ë¡, 1ê°œì˜ ì²´í¬. 
ê²©ë ¤ í•œë§ˆë””ê°€ â€˜ì§€ê¸ˆâ€™ì˜ ê°€ì† í˜ë‹¬ì´ ë¼ìš”.`,
    G: `ë¨¸ë¦¿ì† êµ¬ë¦„ì„ ê±·ì–´ë‚´ëŠ” ì •ë¦¬ë ¥, ê·¸ ìì²´ê°€ ë§ˆìŒì˜ ê¸°ì••ì„ ì•ˆì •ì‹œì¼œìš”. 
í•´ì•¼ í•  ì¼ì„ ì‘ê²Œ ìª¼ê°œë©´ ë¶€ë‹´ì´ ì¤„ê³ , ìš°ì„ ìˆœìœ„ë¥¼ ì„¸ìš°ë©´ ë°œê±¸ìŒì´ ê°€ë²¼ì›Œì ¸ìš”.`,
    F: `ì‚°ë§Œí•¨ì„ ëª¨ì•„ í•œ ì ìœ¼ë¡œ ì‘ì¶•í•˜ëŠ” ëŠ¥ë ¥ì´ ë‹ë³´ì—¬ìš”. 
í•µì‹¬ 1ê°€ì§€ë§Œ ì •í•˜ê³  ì§§ê²Œ ëª°ì…í•˜ë©´ ì„±ì·¨ê°ì´ ë¹ ë¥´ê²Œ ëŒì•„ì˜µë‹ˆë‹¤. 
ì§‘ì¤‘ì€ â€˜ì–‘â€™ë³´ë‹¤ â€˜ê°ë„â€™ì˜ ë¬¸ì œì˜ˆìš”.`,
    B: `â€œë‹¤ì‹œâ€ì˜ ìš©ê¸°ë¥¼ ì•„ëŠ” ì‚¬ëŒ. ê³¼ê±°ì˜ ì‹¤ìˆ˜ë¥¼ ë™ë ¥ìœ¼ë¡œ ë°”ê¾¸ëŠ” ì¬ì‹œì‘ ê°ê°ì´ ìˆì–´ìš”. 
ì˜¤ëŠ˜ í˜ì´ì§€ë¥¼ ì±„ìš°ëŠ” ìˆœê°„, ì´ë¯¸ ìƒˆë¡œìš´ ì´ì•¼ê¸°ê°€ ì‹œì‘ë˜ê³  ìˆìŠµë‹ˆë‹¤.`,

    CR: `ì•ˆì‹¬ì˜ ë”°ëœ»í•¨ê³¼ ë‹¤ë…ì„ì˜ ë¶€ë“œëŸ¬ì›€ì´ í•¨ê»˜ íë¥´ëŠ” ì¡°í•©ì´ì—ìš”. 
ìŠ¤ìŠ¤ë¡œì—ê²Œ ì¹œì ˆí• ìˆ˜ë¡ êº¼ì§„ ë“±ë¶ˆì´ ë‹¤ì‹œ ì¼œì§‘ë‹ˆë‹¤. 
ì˜¤ëŠ˜ì˜ ë‹¹ì‹ ì—ê²Œ í•„ìš”í•œ ê±´ â€œê´œì°®ì•„â€ì™€ â€œì¡°ê¸ˆ ì‰¬ì–´ë„ ë¼.â€`,
    EB: `ê²©ë ¤ì˜ ë¶ˆê½ƒê³¼ ìƒˆì¶œë°œì˜ ë°”ëŒì´ í•©ì³ì§„ íƒ€ì…. 
ì™„ë²½ì£¼ì˜ë¥¼ ì ì‹œ ë‚´ë ¤ë†“ê³  â€˜ì§€ê¸ˆ ê°€ëŠ¥í•œ ìµœì†Œ ë‹¨ìœ„â€™ë¡œ ë¦¬ì…‹í•˜ë©´ ì¶”ì§„ë ¥ì´ ì‚´ì•„ë‚˜ìš”.`,
    GF: `ì •ë¦¬ë¡œ ê¸¸ì„ ë§Œë“¤ê³ , ì§‘ì¤‘ìœ¼ë¡œ ì¶”ì§„í•˜ëŠ” ì¡°í•©ì…ë‹ˆë‹¤. 
ì¹¸ë°˜/ì²´í¬ë¦¬ìŠ¤íŠ¸/íƒ€ì„ë¸”ë¡ì²˜ëŸ¼ ë„êµ¬ì™€ í•¨ê»˜í• ìˆ˜ë¡ ì„±ê³¼ê°€ ë¹¨ë¼ì ¸ìš”.`,
    RE: `ë¨¼ì € ì•ˆì‹¬ì„ ê¹”ê³ , ê·¸ ìœ„ì— í•œ ê±¸ìŒì„ ë”í•©ë‹ˆë‹¤. 
â€œê´œì°®ì•„â€ ë‹¤ìŒì—ëŠ” â€œì§€ê¸ˆë¶€í„°â€ë¥¼ ë†“ì•„ë³´ì„¸ìš”. ì‘ì€ í–‰ë™ì´ íë¦„ì„ ë°”ê¿”ìš”.`,
    CG: `ë‹¤ì •í•œ ì‹œì„ ìœ¼ë¡œ ë‚˜ë¥¼ ë³´ê³ , í•„ìš”í•œ êµ¬ì¡°ë¥¼ ê°€ë³ê²Œ ì„¸ìš°ëŠ” íƒ€ì…. 
ì •ëˆì€ ì™„ë²½ì„±ì´ ì•„ë‹ˆë¼ â€˜ëŒë´„ì˜ í˜•ì‹â€™ì´ì—ìš”.`,
    FB: `í•µì‹¬ë§Œ ë‚¨ê¸°ê³  ìƒˆë¡œ ì‹œì‘! â€˜í•œ ê°€ì§€â€™ì™€ â€˜ì˜¤ëŠ˜â€™ì— ì§‘ì¤‘í•˜ë©´ ì¬ì‹œì‘ì´ ëœ ë¬´ì„œì›Œì§‘ë‹ˆë‹¤. 
ë¦¬ì…‹ì€ í›„í‡´ê°€ ì•„ë‹ˆë¼ ë°©í–¥ ì¬ì„¤ì •ì´ì—ìš”.`
  };

  const REMIND = {
    R: ['ì˜¤ëŠ˜ì˜ ìˆ¨: 4ì´ˆ ë“¤ì´ë§ˆì‹œê³  6ì´ˆ ë‚´ì‰¬ê¸°', 'ë¹„êµ ê¸ˆì§€â€”â€œë‚˜ì˜ ì†ë„í‘œâ€ë¡œ ë³´ê¸°'],
    C: ['ê°ì • í•œ ì¤„ ê¸°ë¡(ê°ì • Â· ìƒí™© Â· í•œë§ˆë””)', 'ë‚˜ì—ê²Œ ë‹¤ì •í•œ í˜¸ì¹­ ë¶™ì´ê¸°'],
    E: ['10ë¶„ íƒ€ì´ë¨¸ ìŠ¤íƒ€íŠ¸', 'ì‘ì—… ì „ â€œì‹œì‘ ì„ ì–¸â€ í•œ ë¬¸ì¥'],
    G: ['ì²´í¬ë¦¬ìŠ¤íŠ¸ 3ê°œë§Œ', 'ìš°ì„ ìˆœìœ„ A-1 í‘œì‹œ'],
    F: ['ë°©í•´ ìš”ì†Œ 1ê°œë§Œ ë„ê¸°(ì•Œë¦¼/íƒ­)', 'ëª°ì… íƒ€ì´ë¨¸ 15ë¶„'],
    B: ['ì˜¤ëŠ˜ í˜ì´ì§€ 1ì¹¸ ì±„ìš°ê¸°', 'ìƒˆ íƒ­ì˜ ì²« ì¤„ ì“°ê¸°'],

    CR: ['â€œê´œì°®ì•„â€ë¥¼ ì… ë°–ìœ¼ë¡œâ€”ê·¸ë¦¬ê³  10ë¶„ ì‚°ì±…', 'ë”°ëœ»í•œ ì°¨ í•œ ì” + í•  ì¼ 1ê°œë§Œ'],
    EB: ['ì‘ê²Œ ì‹œì‘(5ë¶„ ê·œì¹™)', 'ì˜¤ëŠ˜ì˜ â€œì²« ì²´í¬â€ë¥¼ ê°€ì¥ ì‰¬ìš´ ì¼ë¡œ'],
    GF: ['To-Do 3ê°œ â†’ 1ê°œë¡œ ì••ì¶•', 'íƒ€ì„ë¸”ë¡ 25ë¶„ Ã— 1íšŒ'],
    RE: ['ìˆ¨ ê³ ë¥´ê³ , í•œ ì¤„ ì“°ê³ , ë²„íŠ¼ ëˆ„ë¥´ê¸°', 'â€œì§€ê¸ˆë¶€í„°â€ë¼ê³  ì†ì‚­ì´ê¸°'],
    CG: ['ê°ì • ë¼ë²¨ë§ í›„, ì¼ì •í‘œ 3ì¹¸ë§Œ', 'ì •ëˆì€ 80%ë©´ ì¶©ë¶„'],
    FB: ['í•µì‹¬ ëª©í‘œ í•œ ì¤„, ë¦¬ì…‹ ì„ ì–¸ í•œ ì¤„', 'ìƒˆ íŒŒì¼/ìƒˆ í˜ì´ì§€ë¡œ ì‹œì‘']
  };

  function classify(sc){
    // ë‚´ë¶€ ì ìˆ˜ëŠ” UI ë…¸ì¶œí•˜ì§€ ì•ŠìŒ
    const arr = Object.entries(sc).sort((a,b)=>b[1]-a[1]);
    const [k1,v1] = arr[0];
    const [k2,v2] = arr[1];
    const diff    = v1 - v2;

    const STRICT = 2.8; // ë‹¨ì¼ë¡œ ë³¼ ì¶©ë¶„ ê²©ì°¨(íŠœë‹)
    if(diff >= STRICT) return { key:k1, combo:false };

    // ì¡°í•© í‚¤ (ì•ŒíŒŒë²³ìˆœ)
    const pair = [k1,k2].sort().join('+');
    if(TYPES[pair]) return { key:pair, combo:true };

    // í´ë°±: ìƒìœ„ 1ê°œ
    return { key:k1, combo:false };
  }

  function stateBadges(k){
    // ìƒíƒœí˜• ë°°ì§€ ë¬¸êµ¬
    const map = {
      R:['ì•ˆì‹¬','ìˆ˜ìš©'],
      C:['ë‹¤ì •','íšŒë³µ'],
      E:['í™œë ¥','ì‹œì‘'],
      G:['ì •ëˆ','êµ¬ì¡°'],
      F:['ëª°ì…','í•µì‹¬'],
      B:['ë¦¬ì…‹','ìƒˆì¥ë©´'],
      'C+R':['ë‹¤ì •','ì•ˆì‹¬'],
      'E+B':['ì‹œì‘','ì¶”ì§„'],
      'G+F':['ì •ëˆ','ì§‘ì¤‘'],
      'R+E':['ì•ˆì‹¬','ê²©ë ¤'],
      'C+G':['ë‹¤ë…','ì •ë¦¬'],
      'F+B':['ì§‘ì¤‘','ì¬ì‹œì‘']
    };
    const words = map[k] || ['ë§ˆìŒ','ê· í˜•'];
    return words.map(w=>`<div class="pill">${w}</div>`).join('');
  }

  function heroImage(){
    // mindtalk ì „ìš© ì‹¬ë³¼
    return `../assets/mind.png`;
  }

  function finish(){
    card.style.display = 'none';
    barFill.style.width = '100%';

    const { key } = classify(score);
    const t = TYPES[key] || TYPES.R;
    const long = LONG[key] || LONG.R;
    const remind = REMIND[key] || REMIND.R;

    const html = `
      <div class="result-card">
        <div class="result-hero">
          <img src="${heroImage()}" alt="ë§ˆìŒ ì¹´ë“œ" onerror="this.style.display='none'">
          <div>
            <div class="result-title">${t.title}</div>
            <div class="result-desc">${t.quote}</div>
            <div class="state-badges">${stateBadges(t.key)}</div>
          </div>
        </div>

        <p style="margin:10px 0; line-height:1.6">${long}</p>

        <div class="mind-brief" style="margin:10px 0; padding:10px; border:1px solid var(--mint-200); border-radius:12px; background:var(--mint-50)">
          <div style="font-weight:800; margin-bottom:6px">ì˜¤ëŠ˜ì˜ ë§ˆìŒ ìƒíƒœ</div>
          <div class="mini-note">ìˆ«ì ëŒ€ì‹  ìƒíƒœë¡œ ìš”ì•½í–ˆì–´ìš”.</div>
          <ul style="margin:8px 0 0 18px; line-height:1.6">
            ${stateBadges(t.key).replaceAll('pill','').replaceAll('<div ','<li ').replaceAll('</div>','</li>')}
          </ul>
        </div>

        <div class="mind-remind" style="margin-top:10px">
          <div style="font-weight:800; margin-bottom:6px">ğŸŒ¿ ë§ˆìŒ ë¦¬ë§ˆì¸ë“œ</div>
          ${remind.map(s=>`<div class="pill">${s}</div>`).join('')}
        </div>

        <div class="result-actions">
          <a class="start" href="../index.html">ë©”ì¸ìœ¼ë¡œ</a>
          <button class="start" onclick="location.reload()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>
        </div>
      </div>
    `;

    resultBox.innerHTML = html;
    resultBox.style.display = 'block';
  }

  // ì‹œì‘
  render();
});