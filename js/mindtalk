/* ===================================================
 * mindtalk.js â€” ë‚˜ëŠ” ë‚˜ì—ê²Œ ë¬´ìŠ¨ ë§ì„ í•˜ê³  ìˆì„ê¹Œ?
 * ëª½ì‹¤ëª½ì‹¤ ì‹¬ë¦¬í…ŒìŠ¤íŠ¸ ì œì‘ í”„ë¡¬í”„íŠ¸ v2025.2 â€” ë§ˆìŒ ë¦¬ë§ˆì¸ë“œ ë²„ì „
 * =================================================== */
document.addEventListener('DOMContentLoaded', () => {
  console.log("mindtalk.js loaded");

  const Q = [
    {k:'I', q:'ìš”ì¦˜ ë‚˜ë¥¼ ìœ„ë¡œí•˜ëŠ” ë§ë³´ë‹¤, ìŠ¤ìŠ¤ë¡œë¥¼ ë‹¤ê·¸ì¹˜ëŠ” ë§ì´ ë§ë‹¤.'},
    {k:'I', q:'í˜¼ì ìˆëŠ” ì‹œê°„ì´ ë¶ˆì•ˆí•˜ê²Œ ëŠê»´ì§ˆ ë•Œê°€ ìˆë‹¤.'},
    {k:'E', q:'ê°ì • í‘œí˜„ì„ ì†”ì§í•˜ê²Œ í•˜ëŠ” í¸ì´ë‹¤.'},
    {k:'E', q:'ì£¼ë³€ ì‚¬ëŒì˜ ë°˜ì‘ì´ ë‚´ ê¸°ë¶„ì— í¬ê²Œ ì˜í–¥ì„ ì¤€ë‹¤.'},
    {k:'M', q:'ë‚´ê°€ ëŠë¼ëŠ” ê°ì •ì„ ëª…í™•íˆ êµ¬ë¶„í•˜ê¸° ì–´ë µë‹¤.'},
    {k:'M', q:'ê°ì •ë³´ë‹¤ëŠ” ìƒí™© ë…¼ë¦¬ì— ë§ì¶° í–‰ë™í•˜ë ¤ëŠ” í¸ì´ë‹¤.'},
    {k:'S', q:'ì‘ì€ ì‹¤ìˆ˜ì—ë„ ì‰½ê²Œ ìì±…í•œë‹¤.'},
    {k:'S', q:'ìŠ¤ìŠ¤ë¡œë¥¼ ì¹­ì°¬í•˜ëŠ” ë§ì€ ì–´ìƒ‰í•˜ê±°ë‚˜ ë¯¼ë§í•˜ë‹¤.'},
    {k:'B', q:'ë‹¤ë¥¸ ì‚¬ëŒì„ ìœ„ë¡œí•  ë•ŒëŠ” ë§ì´ ì˜ ë‚˜ì˜¤ì§€ë§Œ, ë‚´ê²ŒëŠ” ì–´ë µë‹¤.'},
    {k:'B', q:'ë§ˆìŒì´ ë³µì¡í•  ë•Œ ë‚˜ë§Œì˜ ì •ë¦¬ ë£¨í‹´(ì‚°ì±…, ê¸°ë¡ ë“±)ì´ ìˆë‹¤.'},
    {k:'C', q:'ê°ì •ì´ ì˜¬ë¼ì˜¬ ë•Œ ì ì‹œ ë©ˆì¶”ê³  ìˆ¨ì„ ê³ ë¥´ë ¤ í•œë‹¤.'},
    {k:'C', q:'í•˜ë£¨ì˜ ëì— â€œê·¸ë˜ë„ ê´œì°®ì•„â€ë¼ê³  ë˜ë‡Œì–´ ë³¸ ì  ìˆë‹¤.'}
  ];

  let idx = 0;
  const score = {I:0,E:0,M:0,S:0,B:0,C:0};
  const counts = {I:0,E:0,M:0,S:0,B:0,C:0};
  let start = Date.now();
  const ans = [];

  const step = document.getElementById('stepLabel');
  const bar  = document.getElementById('barFill');
  const qTxt = document.getElementById('qText');
  const wrap = document.getElementById('choiceWrap');
  const card = document.getElementById('card');
  const result = document.getElementById('result');
  const prev = document.getElementById('prev');
  const skip = document.getElementById('skip');

  function render(){
    step.textContent = `${idx+1} / ${Q.length}`;
    bar.style.width = `${(idx/Q.length)*100}%`;
    qTxt.textContent = Q[idx].q;
    wrap.innerHTML = `
      <button class="choice" data-s="4">ë§¤ìš° ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="3">ê·¸ë ‡ë‹¤</button>
      <button class="choice" data-s="2">ë³´í†µì´ë‹¤</button>
      <button class="choice ghost" data-s="1">ì•„ë‹ˆë‹¤</button>
      <button class="choice ghost" data-s="0">ì „í˜€ ì•„ë‹ˆë‹¤</button>
    `;
    Array.from(wrap.children).forEach(btn=>{
      btn.onclick=()=>choose(Number(btn.dataset.s));
    });
    start = Date.now();
  }

  function weight(sec){
    if(sec<1)return 0.9;
    if(sec<4)return 1.0;
    if(sec<8)return 1.15;
    return 1.1;
  }

  function choose(s){
    const elapsed=(Date.now()-start)/1000;
    const k=Q[idx].k;
    const w=weight(elapsed);
    ans[idx]=s;
    const adj=s+(s*(w-1)*0.2);
    score[k]+=adj;
    counts[k]+=1;
    next();
  }

  function next(){
    idx++;
    if(idx<Q.length)render();
    else finish();
  }

  prev.onclick=()=>{if(idx>0){idx--;render();}};
  skip.onclick=()=>{ans[idx]=2;next();};

  function normalize(){
    const avg={};
    for(const k in score){
      const max=counts[k]*4||1;
      avg[k]=score[k]/max;
    }
    return avg;
  }

  function finish(){
    card.style.display='none';
    bar.style.width='100%';
    const avg=normalize();
    const sorted=Object.entries(avg).sort((a,b)=>b[1]-a[1]);
    const [k1,v1]=sorted[0];
    const [k2,v2]=sorted[1];
    const diff=v1-v2;
    const dom=diff>0.25?'strong':'mix';
    const type=dom==='strong'?k1:[k1,k2].sort().join('');

    const TYPE={
      I:{title:'ğŸŒ§ ì‚¬ìƒ‰ê°€í˜•',quote:'â€œì¡°ìš©íˆ ìŠ¤ìŠ¤ë¡œë¥¼ ë“¤ì—¬ë‹¤ë³´ëŠ” ì¤‘ì´ì—ìš”.â€',
          desc:'ë‹¹ì‹ ì˜ ë§ˆìŒì€ ê¹Šì€ ë¬¼ì²˜ëŸ¼ ì°¨ë¶„í•©ë‹ˆë‹¤. ë‚´ë©´ì„ íƒìƒ‰í•˜ë©° ìŠ¤ìŠ¤ë¡œì˜ ì–¸ì–´ë¥¼ ì°¾ê³  ìˆë„¤ìš”.',
          state:'ì˜¤ëŠ˜ì˜ ë§ˆìŒ: íë¦¼ ì†ì—ì„œ ë§‘ìŒì„ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ì´ì—ìš”.',
          remind:'ê°€ë”ì€ ìƒê° ëŒ€ì‹  ê°ê°ì„ ë¯¿ì–´ë³´ì„¸ìš”. ë”°ëœ»í•œ ì°¨ í•œ ì”ìœ¼ë¡œ ë§ˆìŒì„ ë…¹ì—¬ìš”.'},
      E:{title:'ğŸŒ í™œë ¥ ì „ë‹¬í˜•',quote:'â€œë‚´ ì—ë„ˆì§€ëŠ” ì£¼ë³€ì— ìŠ¤ë©°ë“œëŠ” ë¹›.â€',
          desc:'ë‹¹ì‹ ì€ ë°ê³  ë”°ëœ»í•œ ì‚¬ëŒì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë“¤ì˜ ë§ˆìŒì— ì˜¨ê¸°ë¥¼ ì „í•˜ë©° ì„¸ìƒì„ ì¡°ê¸ˆì”© ë¬¼ë“¤ì…ë‹ˆë‹¤.',
          state:'ì˜¤ëŠ˜ì˜ ë§ˆìŒ: í–‡ì‚´ì²˜ëŸ¼ ê¸ì •ì ì¸ íŒŒë™ì´ ë„ëŠ” í•˜ë£¨ì˜ˆìš”.',
          remind:'ë‹¹ì‹ ì˜ ì˜¨ê¸°ëŠ” ì¶©ë¶„í•´ìš”. ì ì‹œ ë©ˆì¶° ê·¸ ë”°ìŠ¤í•¨ì„ ë³¸ì¸ì—ê²Œë„ ë‚˜ëˆ ì£¼ì„¸ìš”.'},
      M:{title:'ğŸŒ¤ ê· í˜• íƒìƒ‰í˜•',quote:'â€œë§ˆìŒê³¼ ìƒê° ì‚¬ì´, ë‚˜ëŠ” ê·¸ ì¤‘ê°„ì—ì„œ ê¸¸ì„ ì°¾ëŠ”ë‹¤.â€',
          desc:'ì´ì„±ê³¼ ê°ì •ì„ ëª¨ë‘ ì¡´ì¤‘í•˜ëŠ” ì‚¬ëŒì…ë‹ˆë‹¤. ê³ ë¯¼ì€ ë§ì§€ë§Œ, ê·¸ ì•ˆì—ì„œ ì¡°í™”ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.',
          state:'ì˜¤ëŠ˜ì˜ ë§ˆìŒ: ì”ì”í•œ êµ¬ë¦„ ì‚¬ì´ë¡œ ë¹›ì´ ë¹„ì¹˜ëŠ” ì¤‘ì´ì—ìš”.',
          remind:'ê²°ì •ì´ ì–´ë ¤ìš¸ ë• â€œì§€ê¸ˆ ì´ ìˆœê°„ ê°€ì¥ í¸ì•ˆí•œ ì„ íƒâ€ì„ í•´ë„ ê´œì°®ì•„ìš”.'},
      S:{title:'ğŸŒ§ ìì±… ì™„í™”í˜•',quote:'â€œê´œì°®ì•„, ë‹¤ìŒì— ì˜í•˜ë©´ ë¼.â€',
          desc:'ìŠ¤ìŠ¤ë¡œì—ê²Œ ì¡°ê¸ˆì€ ì—„ê²©í•˜ì§€ë§Œ ì§„ì‹¬ ì–´ë¦° ì‚¬ëŒì…ë‹ˆë‹¤. ì™„ë²½ë³´ë‹¤ ê¾¸ì¤€í•¨ì´ ë‹¹ì‹ ì˜ í˜ì´ì—ìš”.',
          state:'ì˜¤ëŠ˜ì˜ ë§ˆìŒ: ì ì‹œ ë¹„ê°€ ì˜¤ì§€ë§Œ, ì´ ë¹„ëŠ” ì„±ì¥ì˜ ë¬¼ì´ì—ìš”.',
          remind:'ì‹¤ìˆ˜ëŠ” ê³¼ì •ì´ì—ìš”. ê·¸ë§Œí¼ ë‹¹ì‹ ì€ ì›€ì§ì´ê³  ìˆë‹¤ëŠ” ì¦ê±°ëë‹ˆë‹¤.'},
      B:{title:'ğŸŒˆ ìœ„ë¡œ ì „ë‹¬í˜•',quote:'â€œìœ„ë¡œëŠ” ë‚˜ì—ì„œ ì‹œì‘ë¼, ë„ˆì—ê²Œ ë‹¿ëŠ”ë‹¤.â€',
          desc:'ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì„ ì˜ ì½ê³ , ê³µê°í•˜ëŠ” ë‹¹ì‹ ì€ ì„¸ìƒì— ë¶€ë“œëŸ¬ìš´ ìƒ‰ì„ ì…íˆëŠ” ì‚¬ëŒì…ë‹ˆë‹¤.',
          state:'ì˜¤ëŠ˜ì˜ ë§ˆìŒ: ë¬´ì§€ê°¯ë¹› ê°ì •ì´ í”¼ì–´ë‚˜ê³  ìˆì–´ìš”.',
          remind:'íƒ€ì¸ì—ê²Œ ì£¼ë˜ ë‹¤ì •í•¨ì„ ì˜¤ëŠ˜ì€ ë‚˜ì—ê²Œ ì„ ë¬¼í•´ë³´ì„¸ìš”.'},
      C:{title:'ğŸŒ™ ë§ˆìŒ ì•ˆì •í˜•',quote:'â€œê³ ìš”í•¨ì€ ë‚˜ë¥¼ íšŒë³µì‹œí‚¨ë‹¤.â€',
          desc:'ë‹¹ì‹ ì€ ê°ì •ì˜ íŒŒë„ ì†ì—ì„œë„ ê· í˜•ì„ ìƒì§€ ì•ŠìŠµë‹ˆë‹¤. ëŠë¦¼ì˜ ë¯¸í•™ì„ ì•„ëŠ” í˜„ëª…í•œ ì‚¬ëŒì…ë‹ˆë‹¤.',
          state:'ì˜¤ëŠ˜ì˜ ë§ˆìŒ: ì”ì”í•œ ë°¤í•˜ëŠ˜ ì•„ë˜ ìˆ¨ ê³ ë¥´ê¸° ì¤‘ì´ì—ìš”.',
          remind:'ì²œì²œíˆ, ê·¸ë¦¬ê³  ê¾¸ì¤€íˆ â€” ê·¸ê²Œ ë‹¹ì‹ ì˜ ë¦¬ë“¬ì´ì—ìš”.'}
    };

    const info = TYPE[type] || TYPE.M;
    const bars = Object.entries(avg).map(([k,v])=>{
      const name = ({I:'ë‚´ë©´ì„±',E:'í‘œí˜„ë ¥',M:'ê· í˜•ê°',S:'ìê¸°ë¹„íŒ',B:'ê³µê°ë ¥',C:'ì•ˆì •ê°'})[k];
      const pct = Math.round(v*100);
      let label='';
      if(pct>75)label='ë†’ìŒ';
      else if(pct>50)label='ì ë‹¹í•¨';
      else label='ë‚®ìŒ';
      return `<div style="margin:6px 0">
        <div style="display:flex;justify-content:space-between;font-weight:700"><span>${name}</span><span>${label}</span></div>
        <div style="height:8px;background:var(--mint-200);border-radius:999px;overflow:hidden">
          <span style="display:block;height:100%;width:${pct}%;background:var(--mint-500)"></span>
        </div>
      </div>`;
    }).join('');

    result.innerHTML=`
      <div class="result-card">
        <div class="result-hero">
          <img src="../assets/brain.png" alt="${info.title}">
          <div class="result-title">${info.title}</div>
          <p class="result-quote">${info.quote}</p>
        </div>
        <p>${info.desc}</p>
        <p class="state">${info.state}</p>
        <p class="remind">ğŸŒ¿ ë§ˆìŒ ë¦¬ë§ˆì¸ë“œ: ${info.remind}</p>
        <div class="bars">${bars}</div>
        <div class="result-actions">
          <a class="start" href="../index.html">ë©”ì¸ìœ¼ë¡œ</a>
          <button class="start" onclick="location.reload()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>
        </div>
      </div>`;
    result.style.display='block';
  }

  render();
});